"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),spinner=null,environment="debug",dialogPresenter=null,Configuration={},Bootstrapper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"Run",value:function(){function d(){var a=$(this),b=a.find(".modal-dialog");a.css("display","block"),b.css("margin-top",Math.max(0,($(window).height()-b.height())/2))}var b=$.Deferred(),c=null;spinner=new LoadingSpinner,dialogPresenter=new DialogPresenter,$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()}),$("body").scrollspy({target:".navbar-fixed-top"}),$(".modal").on("show.bs.modal",d),$(window).on("resize",function(){$(".modal:visible").each(d)});var e="Application failed to initialize.";return async.series([function(a){$("#order-form-tmpl").load("./templates/order-form-tmpl.html",function(b,c,d){"error"===c?a(e):a()})},function(a){$("#gift-form-tmpl").load("./templates/gift-form-tmpl.html",function(b,c,d){"error"===c?a(e):a()})},function(a){$("#contact-modal-tmpl").load("./templates/contact-modal-tmpl.html",function(b,c,d){"error"===c?a(e):a()})},function(a){$("#login-modal-tmpl").load("./templates/login-modal-tmpl.html",function(b,c,d){"error"===c?a(e):a()})},function(a){$("#vehicle-tmpl").load("./templates/vehicle-tmpl.html",function(b,c,d){"error"===c?a(e):a()})},function(a){$("#location-tmpl").load("./templates/location-tmpl.html",function(b,c,d){"error"===c?a(e):a()})},function(a){c=new WebService,c.GetEnvironment().then(function(b){environment=b,a()}).fail(function(b){return a(b)})},function(a){c.GetSystemSettings().then(function(b){Configuration=new Configuration(b),a()}).fail(function(b){return a(b)})},function(a){var b=new LocalStorageHelper(sessionStorage),d=new OrderFormViewModel(b,c),e=new GiftFormViewModel(b,c),f=new LogInViewModel(b,c),g=new MainViewModel(b,f,d,e);ko.applyBindings(g),c.GetFutureAppointments().then(function(c){var d=_.groupBy(c,function(a){return moment(a.date).format(Configuration.DATE_FORMAT)});b.AppointmentsByDate=d,a()}).fail(function(b){a(b)})}],function(a){a?b.reject(a):b.resolve()}),b.promise()}}]),a}(),cbpAnimatedHeader=function(){function e(){window.addEventListener("scroll",function(a){c||(c=!0,setTimeout(f,250))},!1)}function f(){var a=g();a>=d?classie.add(b,"navbar-shrink"):classie.remove(b,"navbar-shrink"),c=!1}function g(){return window.pageYOffset||a.scrollTop}var a=document.documentElement,b=document.querySelector(".navbar-default"),c=!1,d=300;e()}();!function(a){function b(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function f(a,b){var f=c(a,b)?e:d;f(a,b)}var c,d,e;"classList"in document.documentElement?(c=function(b,c){return b.classList.contains(c)},d=function(b,c){b.classList.add(c)},e=function(b,c){b.classList.remove(c)}):(c=function(c,d){return b(d).test(c.className)},d=function(b,d){c(b,d)||(b.className=b.className+" "+d)},e=function(c,d){c.className=c.className.replace(b(d)," ")});var g={hasClass:c,addClass:d,removeClass:e,toggleClass:f,has:c,add:d,remove:e,toggle:f};"function"==typeof define&&define.amd?define(g):a.classie=g}(window);var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Configuration=function(){function a(b){_classCallCheck(this,a),this.settings=b}return _createClass(a,[{key:"StripeKey",get:function(){return"production"==environment?"pk_live_aULtlGy6YPvc94K5Hjvqwokg":"pk_test_luqEThs0vblV173fgAHgPZBG"}},{key:"DATE_FORMAT",get:function(){return this.settings.DATE_FORMAT||"MM/DD/YY"}},{key:"DEFAULT_JOB_TIME_MINS",get:function(){return this.settings.DEFAULT_JOB_TIME_MINS||120}},{key:"MAX_JOB_TIME_PER_DAY_MINS",get:function(){return this.settings.MAX_JOB_TIME_PER_DAY_MINS||720}},{key:"MAX_JOB_TIME_PER_INTERVAL",get:function(){return this.settings.MAX_JOB_TIME_PER_INTERVAL||180}},{key:"AVG_JOB_DRIVING_TIME",get:function(){return this.settings.AVG_JOB_DRIVING_TIME||30}},{key:"AVG_JOB_SETUP_TIME",get:function(){return this.settings.JOB_SETUP_TIME||10}},{key:"WASH_DETAILS",get:function(){return this.settings.WASH_DETAILS||{price:22,time:30,title:"Exterior Hand Wash"}}},{key:"TIRE_SHINE_DETAILS",get:function(){return this.settings.TIRE_SHINE_DETAILS||{price:8,time:15,title:"Tire Shine"}}},{key:"INTERIOR_DETAILS",get:function(){return this.settings.INTERIOR_DETAILS||{price:40,time:45,title:"Interior Cleaning"}}},{key:"WAX_DETAILS",get:function(){return this.settings.WAX_DETAILS||{price:30,time:40,title:"Hand Wax"}}},{key:"CAR_SIZES",get:function(){return this.settings.CAR_SIZES||[{multiplier:1,size:"Compact (2-4 door)"},{multiplier:1.2,size:"Mid-Size"},{multiplier:1.4,size:"Large (SUV)"}]}},{key:"ZIP_WHITE_LIST",get:function(){return this.settings.ZIP_WHITE_LIST||["22314","22301","22305","22302","22304","22202","22206","22311","22312","22204","22041","22211","22201","22203","22209","22044","22151","22150","22152","22153","22015","22205","22042","22046","22003","22207","22213","22031","22043","22027","22101","22182","22030","22032","22039","20124"]}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),ASYNC_INTERUPTION_MARKER="ASYNC_INTERUPTION_MARKER",CHARGE_FAILURE_MARKER="CARD_CHARGE_FAILURE",MORNING_TIME_RANGE={range:"9:00 AM - 12:00 PM",key:1,disabled:ko.observable(!1)},AFTERNOON_TIME_RANGE={range:"12:00 - 3:00 PM",key:2,disabled:ko.observable(!1)},EVENING_TIME_RANGE={range:"3:00 - 6:00 PM",key:3,disabled:ko.observable(!1)},NIGHT_TIME_RANGE={range:"6:00 - 9:00 PM",key:4,disabled:ko.observable(!1)},TIME_RANGE_PLACE_HOLDER={range:"",disabled:ko.observable(!0)},Constants=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"MORNING_TIME_RANGE",get:function(){return MORNING_TIME_RANGE}},{key:"AFTERNOON_TIME_RANGE",get:function(){return AFTERNOON_TIME_RANGE}},{key:"EVENING_TIME_RANGE",get:function(){return EVENING_TIME_RANGE}},{key:"NIGHT_TIME_RANGE",get:function(){return NIGHT_TIME_RANGE}},{key:"ASYNC_INTERUPTION_MARKER",get:function(){return ASYNC_INTERUPTION_MARKER}},{key:"CHARGE_FAILURE_MARKER",get:function(){return CHARGE_FAILURE_MARKER}},{key:"TIME_RANGE_PLACE_HOLDER",get:function(){return TIME_RANGE_PLACE_HOLDER}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),DialogPresenter=function(){function a(){_classCallCheck(this,a),this.title=ko.observable(""),this.body=ko.observable(""),this.$modal=$("#generic-modal")}return _createClass(a,[{key:"ShowOrderFailure",value:function(){this.title("Oh no :("),this.body("We're really sorry about this... Looks like there was a problem submitting your order. Please contact us for support."),this.$modal.modal("show")}},{key:"ShowOrderSuccess",value:function(){this.title("Thank you!"),this.body("Your order has been placed. Please check your email for confirmation."),this.$modal.modal("show")}},{key:"ShowBadZip",value:function(){this.title("Darn! We don't service that area yet."),this.body(s.sprintf("We're still young and growing so check back soon. Feel free to               <a href=%s>contact us</a> so we know where to target next.","javascript:$('.modal').removeClass('fade');$('.modal').modal('hide');$('#contact-modal').modal('show');$('.modal').addClass('fade');")),this.$modal.modal("show")}}]),a}();window.jQuery(document).ready(function(a){try{Bootstrapper.Run().then(function(){var b=setTimeout(function(){a("#splash").fadeOut(1e3),clearTimeout(b)},1e3)}).fail(function(b){console.error(b),a("#splash").append("<div><h3>Website under maintenance. We apologize for the inconvenience</h3></div>")})}catch(a){console.error(a)}});var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),LocalStorageHelper=function(){function a(b){_classCallCheck(this,a);try{this.storageType.test="test",this.storageType=b}catch(a){console.info("No local storage available. Using memory..."),this.storageType={}}}return _createClass(a,[{key:"ZipCode",get:function(){return this.storageType&&this.storageType.zip?this.storageType.zip:""},set:function(b){this.storageType&&(this.storageType.zip=b)}},{key:"AppointmentsByDate",get:function(){return this.storageType&&this.storageType.appointments?JSON.parse(this.storageType.appointments):[]},set:function(b){this.storageType&&(this.storageType.appointments=JSON.stringify(b))}},{key:"LoggedInUser",get:function(){return this.storageType&&this.storageType.loggedInUser?JSON.parse(this.storageType.loggedInUser):null},set:function(b){this.storageType&&(this.storageType.loggedInUser=JSON.stringify(b))}},{key:"IsNewUser",get:function(){return!(!this.storageType||!this.storageType.isNewUser)&&JSON.parse(this.storageType.isNewUser)},set:function(b){this.storageType&&(this.storageType.isNewUser=JSON.stringify(b))}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),LoadingSpinner=function(){function a(){_classCallCheck(this,a);var b=12,c=12,d=30,e=b+c+d;this.spinner=null,this.options={lines:13,length:c,width:b,radius:d,scale:1,corners:1,color:"#0076A3",opacity:.35,rotate:0,direction:1,speed:.8,trail:45,fps:20,zIndex:2e9,className:"spinner",top:"-"+e.toString(),left:"-"+e.toString(),shadow:!0,hwaccel:!0,position:"relative"},this.spinnerOverlay=$("#page-load-spinner"),this.spinnerContainer=document.getElementById("spinner-container")}return _createClass(a,[{key:"Show",value:function(){$(this.spinnerOverlay).is(":visible")||(this.spinnerOverlay.show(),this.spinner?this.spinner.spin(this.spinnerContainer):this.spinner=new Spinner(this.options).spin(this.spinnerContainer))}},{key:"Hide",value:function(){this.spinnerOverlay.hide(),this.spinner&&this.spinner.stop()}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Utils=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"GetListOfDisabledDates",value:function(b){if(!b)return[];var c=[];for(var d in b)if(b.hasOwnProperty(d)){var e=0,f=b[d];_.each(f,function(a){e+=a.timeEstimate?a.timeEstimate:Configuration.DEFAULT_JOB_TIME_MINS}),e>Configuration.MAX_JOB_TIME_PER_DAY_MINS&&c.push(_.first(f).date)}return c}},{key:"VerifyZip",value:function(b){return _.contains(Configuration.ZIP_WHITE_LIST,b.trim())}},{key:"IsStrEqual",value:function(b,c){var d=b.trim().toUpperCase(),e=c.trim().toUpperCase();return d===e}},{key:"GenerateUUID",value:function(){var b=(new Date).getTime(),c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(b+16*Math.random())%16|0;return b=Math.floor(b/16),("x"==a?c:3&c|8).toString(16)});return c}},{key:"IsHoliday",value:function(b){var c={M:{"01/01":"New Year's Day","07/04":"Independence Day","11/11":"Veteran's Day","12/24":"Christmas Eve","12/25":"Christmas Day","12/31":"New Year's Eve"},W:{"1/3/1":"Martin Luther King Jr. Day","2/3/1":"Washington's Birthday","5/5/1":"Memorial Day","9/1/1":"Labor Day","10/2/1":"Columbus Day","11/4/4":"Thanksgiving Day"}},d=b.toDate(),e=1+(0|(d.getDate()-1)/7),f=1===d.getDay()&&d.getDate()+7>30?"5":null;return c.M[b.format("MM/DD")]||c.W[b.format("M/"+(f||e)+"/d")]}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),GiftFormViewModel=function(){function a(b,c){_classCallCheck(this,a);var d=this;this.stripeHandler=StripeCheckout.configure({key:Configuration.StripeKey,image:"/img/square_logo.png",locale:"auto",token:this._completeOrder.bind(this)}),$(window).on("popstate",function(){d.stripeHandler.close()}),this.storageHelper=b,this.webSvc=c,this.$giftFormModal=$("#gift-form-modal"),this.TIRE_SHINE_COST=Configuration.TIRE_SHINE_DETAILS.price,this.INTERIOR_COST=Configuration.INTERIOR_DETAILS.price,this.WAX_COST=Configuration.WAX_DETAILS.price,this.WASH_COST=Configuration.WASH_DETAILS.price,this.TIRE_SHINE_TITLE=Configuration.TIRE_SHINE_DETAILS.title,this.INTERIOR_TITLE=Configuration.INTERIOR_DETAILS.title,this.WAX_TITLE=Configuration.WAX_DETAILS.title,this.WASH_TITLE=Configuration.WASH_DETAILS.title,this.incompleteGiftMsg=ko.observable(""),this.addWash=ko.observable(!0),this.addShine=ko.observable(!1),this.addWax=ko.observable(!1),this.addInterior=ko.observable(!1),this.carSizes=Configuration.CAR_SIZES,this.selectedCarSize=ko.observable(this.carSizes[0]),this.email=ko.observable(""),this.zip=ko.observable(this.storageHelper.ZipCode),this.orderTotal=ko.computed(function(){var a=0,b=(d.addWash()?d.WASH_COST:0)+(d.addShine()&&d.addWash()?d.TIRE_SHINE_COST:0)+(d.addWax()&&d.addWash()?d.WAX_COST:0)+(d.addInterior()?d.INTERIOR_COST:0);return a+=d.selectedCarSize().multiplier*b,a.toFixed(2)}),this.orderSummary=ko.computed(function(){var a="";return a+=d._buildServicesSummary()+"<hr>",a+=$.validator.format("<strong>{0}</strong>{1}<br>",d.selectedCarSize().size,d.selectedCarSize().multiplier>1?" - additional "+Math.round(100*(d.selectedCarSize().multiplier-1)).toString()+"%":"")})}return _createClass(a,[{key:"OnAfterRender",value:function(b,c){c.$giftForm=$("#gift-form"),c._initValidation()}},{key:"OnSubmit",value:function(){return this.addWash()||this.addInterior()?this.$giftForm.valid()?Utils.VerifyZip(this.zip())?($("#incomplete-gift-alert").hide(),void this._openCheckout()):(this.incompleteGiftMsg("Sorry but we currently don't service within that zip code."),void $("#incomplete-gift-alert").show()):(this.incompleteGiftMsg("Please fill in required details."),void $("#incomplete-gift-alert").show()):(this.incompleteGiftMsg("Interior and/or exterior cleaning must be selected."),void $("#incomplete-gift-alert").show())}},{key:"OnFormCancel",value:function(){try{$("#incomplete-gift-alert").hide(),this.$giftFormModal.modal("hide"),this.$giftForm.validate().resetForm(),this._resetObservables(),window.location="#page-top"}catch(a){console.log("Failed to reset fields OnFormCancel()"),console.log(a)}}},{key:"_openCheckout",value:function(){var b=parseInt(100*this.orderTotal());this.stripeHandler.open({key:Configuration.StripeKey,name:"WMC Checkout",amount:b,zipCode:!0,email:this.email()})}},{key:"_completeOrder",value:function(b){try{var c=this;spinner.Show(),async.waterfall([this._executeCharge.bind(this,b),this._sendGiftConfirmation.bind(this)],function(a){a===Constants.CHARGE_FAILURE_MARKER?(c.incompleteGiftMsg("That card information didn't work."),$("#incomplete-gift-alert").show()):a?c._onOrderFailure(a):c._onOrderSuccess()})}catch(a){this._onOrderFailure(a)}}},{key:"_onOrderFailure",value:function(b){this.$giftFormModal.modal("hide"),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderFailure(),console.log(b)},200)}},{key:"_onOrderSuccess",value:function(){this.OnFormCancel(),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderSuccess()},200)}},{key:"_sendGiftConfirmation",value:function(b){this.webSvc.SendGiftEmail(this.email(),this.orderTotal()).then(function(){return b()}).fail(function(a){return b(a)})}},{key:"_executeCharge",value:function(b,c){var d=parseInt(100*this.orderTotal());this.webSvc.ExecuteCharge(b,d).then(function(){return c()}).fail(function(a){console.log(a),c(Constants.CHARGE_FAILURE_MARKER)})}},{key:"_resetObservables",value:function(){this.incompleteGiftMsg(""),this.addWash(!0),this.addShine(!1),this.addWax(!1),this.addInterior(!1),this.selectedCarSize(this.carSizes[0]),this.email(""),this.zip("")}},{key:"_initValidation",value:function(){this.$giftForm.validate({rules:{zip:"required",email:{required:!0,email:!0}},messages:{email:"Please enter a valid email address."}})}},{key:"_buildServicesSummary",value:function(){var b="";return this.addWash()&&(b+=Configuration.WASH_DETAILS.title+"<br>"),this.addShine()&&(b+=Configuration.TIRE_SHINE_DETAILS.title+"<br>"),this.addWax()&&(b+=Configuration.WAX_DETAILS.title+"<br>"),this.addInterior()&&(b+=Configuration.INTERIOR_DETAILS.title+"<br>"),b}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),LogInViewModel=function(){function a(b,c){_classCallCheck(this,a),this.storageHelper=b,this.webSvc=c,this.$loginModal=$("#login-modal"),this.$orderFormModal=$("#order-form-modal"),this.$loginForm=$("#login-form"),this.$createAcctForm=$("#create-acct-form"),this.$forgotPwdForm=$("#forgot-pwd-form"),this.$loginFormAlert=$("#login-form-alert"),this.$loginFormInfo=$("#login-form-info"),this.ShowLogin=ko.observable(!0),this.ShowCreateAcct=ko.observable(!1),this.ShowForgotPwd=ko.observable(!1),this.loginFormMsg=ko.observable(""),this.email=ko.observable(),this.pwd=ko.observable(),this.firstName=ko.observable(""),this.lastName=ko.observable(""),this.phone=ko.observable(""),this.verifyPwd=ko.observable(""),this.verifyEmail=ko.observable(""),this._initValidation()}return _createClass(a,[{key:"OnDismissMsg",value:function(){this.$loginFormAlert.hide(),this.$loginFormInfo.hide()}},{key:"OnContinueAsGuest",value:function(){this.storageHelper.LoggedInUser=null,this.storageHelper.IsNewUser=!1,this.OnDismissMsg(),this._resetForms(),this._toggleModals()}},{key:"OnShowCreateAcct",value:function(){this._resetForms(),this.ShowForgotPwd(!1),this.ShowLogin(!1),this.ShowCreateAcct(!0),this.OnDismissMsg()}},{key:"OnCancelCreateAcct",value:function(){this._resetForms(),this.ShowForgotPwd(!1),this.ShowCreateAcct(!1),this.ShowLogin(!0),this.OnDismissMsg()}},{key:"OnCreateAcct",value:function(){var b=this;this.$createAcctForm.valid()&&(spinner.Show(),async.series([this._checkIfUserExists.bind(this),this._createNewUser.bind(this)],function(a){spinner.Hide(),a===Constants.ASYNC_INTERUPTION_MARKER?(b.loginFormMsg("That email is already in use! Did you forget your password?"),b.$loginFormAlert.show()):a?(b.loginFormMsg("There was a problem creating your account."),b.$loginFormAlert.show()):(b.storageHelper.IsNewUser=!0,b.OnCancelCreateAcct(),b._toggleModals())}))}},{key:"OnLogIn",value:function(){var b=this;this.$loginForm.valid()&&(spinner.Show(),this.webSvc.GetUserByEmailAndPwd(this.email(),this.pwd()).then(function(a){a?(b.storageHelper.LoggedInUser=a,b.storageHelper.IsNewUser=!1,b._resetForms(),b._toggleModals()):(b.loginFormMsg("Hmmm, we didn't find an account matching those credentials. \t\t\t\t\t\t\tPlease verify your info and try again or click the 'Forgot Password' link."),b.$loginFormAlert.show(),b._resetForms())}).fail(function(a){b._resetForms(),b.loginFormMsg("Uh oh... something went wrong."),b.$loginFormAlert.show()}).always(function(){return spinner.Hide()}))}},{key:"OnShowForgotPwd",value:function(){this._resetForms(),this.ShowLogin(!1),this.ShowCreateAcct(!1),this.ShowForgotPwd(!0),this.OnDismissMsg()}},{key:"OnCancelForgotPwd",value:function(){this._resetForms(),this.ShowCreateAcct(!1),this.ShowForgotPwd(!1),this.ShowLogin(!0),this.OnDismissMsg()}},{key:"OnSubmitForgotPwd",value:function(){if(this.$forgotPwdForm.valid()){var b=this;spinner.Show(),this.webSvc.ForgotPassword(this.email()).then(function(){b.loginFormMsg("Nice! Check your email ;)"),b.$loginFormInfo.show(),b._resetForms(),b.ShowCreateAcct(!1),b.ShowForgotPwd(!1),b.ShowLogin(!0)}).fail(function(a){b.loginFormMsg("Uh oh... something went wrong."),b.$loginFormAlert.show(),console.log(a),b._resetForms()}).always(function(){return spinner.Hide()})}}},{key:"_checkIfUserExists",value:function(b){this.webSvc.GetUserByEmail(this.email()).then(function(a){a&&!a.isGuest?b(Constants.ASYNC_INTERUPTION_MARKER):b()}).fail(function(a){b(a)})}},{key:"_createNewUser",value:function(b){var c=this,d={email:this.email(),pwd:this.pwd(),isGuest:!1};this.webSvc.CreateUser(d).then(function(a){c.storageHelper.LoggedInUser=a,b()}).fail(function(a){b(a)})}},{key:"_resetForms",value:function(){this.$loginForm.find("input").val(""),this.$loginForm.validate().resetForm(),this.$createAcctForm.find("input").val(""),this.$createAcctForm.validate().resetForm(),this.$forgotPwdForm.find("input").val(""),this.$forgotPwdForm.validate().resetForm()}},{key:"_toggleModals",value:function(){this.$loginModal.removeClass("fade"),this.$loginModal.modal("hide"),this.$loginModal.addClass("fade"),this.$orderFormModal.modal("show")}},{key:"_initValidation",value:function(){var b=this;$.validator.addMethod("pwdLength",function(a){return a&&a.length>=8}),$.validator.addMethod("pwdEqual",function(){return b.pwd()===b.verifyPwd()},"Passwords do not match!"),$.validator.addMethod("emailEqual",function(){return Utils.IsStrEqual(b.email(),b.verifyEmail())},"Emails do not match!"),this.$createAcctForm.validate({rules:{email:{required:!0,email:!0},verifyEmail:{required:!0,emailEqual:!0},pwd:{required:!0,pwdLength:!0},verifyPwd:{required:!0,pwdEqual:!0}},messages:{email:"Please enter a valid email address.",pwd:"Password must be at least 8 characters."}}),this.$loginForm.validate({rules:{email:{required:!0,email:!0},pwd:"required"},messages:{email:"Please enter a valid email address.",pwd:"Password required."}}),this.$forgotPwdForm.validate({rules:{email:{required:!0,email:!0},verifyEmail:{required:!0,emailEqual:!0}},messages:{email:"Please enter a valid email address."}})}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),MainViewModel=function(){function a(b,c,d,e){_classCallCheck(this,a),this.WASH_COST=Configuration.WASH_DETAILS.price,this.WashPriceHtml="<sup>$</sup>"+this.WASH_COST,this.TireShinePriceHtml="<sup>$</sup>"+Configuration.TIRE_SHINE_DETAILS.price,this.InteriorPriceHtml="<sup>$</sup>"+Configuration.INTERIOR_DETAILS.price,this.WaxPriceHtml="<sup>$</sup>"+Configuration.WAX_DETAILS.price,this.WASH_TITLE=Configuration.WASH_DETAILS.title,this.TIRE_SHINE_TITLE=Configuration.TIRE_SHINE_DETAILS.title,this.WAX_TITLE=Configuration.WAX_DETAILS.title,this.INTERIOR_TITLE=Configuration.INTERIOR_DETAILS.title,this.LogInViewModel=c,this.OrderFormViewModel=d,this.GiftFormViewModel=e,this.storageHelper=b,this.zip=ko.observable(""),this.storageHelper.ZipCode?this.zipVerified=ko.observable(!0):this.zipVerified=ko.observable(!1)}return _createClass(a,[{key:"DialogPresenter",get:function(){return dialogPresenter}}]),_createClass(a,[{key:"OnPageScroll",value:function(b,c){var d=$(c.currentTarget);$("html, body").stop().animate({scrollTop:$(d.attr("href")).offset().top},1500,"easeInOutExpo"),c.preventDefault()}},{key:"OnVerifyZip",value:function(){Utils.VerifyZip(this.zip())?(this.zipVerified(!0),this.storageHelper.ZipCode=this.zip()):(dialogPresenter.ShowBadZip(),this.zip(""))}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),OrderFormViewModel=function(){function a(b,c){_classCallCheck(this,a);var d=this;this.stripeHandler=StripeCheckout.configure({key:Configuration.StripeKey,image:"/img/square_logo.png",locale:"auto",token:this._completeOrder.bind(this)}),$(window).on("popstate",function(){d.stripeHandler.close()}),this.webSvc=c,this.storageHelper=b,this.$orderFormModal=$("#order-form-modal"),this.$orderFormModal.on("show.bs.modal",function(){d._prePopulateUserData()}),this.TIRE_SHINE_COST=Configuration.TIRE_SHINE_DETAILS.price,this.INTERIOR_COST=Configuration.INTERIOR_DETAILS.price,this.WAX_COST=Configuration.WAX_DETAILS.price,this.WASH_COST=Configuration.WASH_DETAILS.price,this.TIRE_SHINE_TITLE=Configuration.TIRE_SHINE_DETAILS.title,this.INTERIOR_TITLE=Configuration.INTERIOR_DETAILS.title,this.WAX_TITLE=Configuration.WAX_DETAILS.title,this.WASH_TITLE=Configuration.WASH_DETAILS.title,this.disableEmailInput=ko.observable(!1),this.incompleteFormMsg=ko.observable(""),this.showNewUserAlert=ko.observable(!1),this.addWash=ko.observable(!0),this.addShine=ko.observable(!1),this.addWax=ko.observable(!1),this.addInterior=ko.observable(!1),this.description=ko.observable(""),this.timeRangeOptions=[Constants.TIME_RANGE_PLACE_HOLDER,Constants.MORNING_TIME_RANGE,Constants.AFTERNOON_TIME_RANGE,Constants.EVENING_TIME_RANGE],this.selectedTimeRange=ko.observable(Constants.TIME_RANGE_PLACE_HOLDER),this.dateMoment=null,this.showAddVehicleForm=ko.observable(!1),this.cars=ko.observableArray([]),this.make=ko.observable(""),this.model=ko.observable(""),this.color=ko.observable(""),this.carSizes=Configuration.CAR_SIZES,this.selectedCarSize=ko.observable(this.carSizes[0]),this.first=ko.observable(""),this.last=ko.observable(""),this.email=ko.observable(""),this.phone=ko.observable(""),this.showAddLocationForm=ko.observable(!1),this.locations=ko.observableArray([]),this.locationTitleOptions=["Home","Work","Other"],this.title=ko.observable(this.locationTitleOptions[0]),this.street=ko.observable(""),this.city=ko.observable(""),this.zip=ko.observable(this.storageHelper.ZipCode),this.hideSubscriptionForm=ko.observable(!0),this.subIntervals=[1,2,3],this.selectedSubInterval=ko.observable(this.subIntervals[0]),this.subSpans=[{days:7,display:"Week(s)"},{days:28,display:"Month(s)"}],this.selectedSubSpan=ko.observable(this.subSpans[0]),this.couponCode=ko.observable(""),this.coupon=ko.observable(null),this.orderTotal=ko.computed(function(){var a=0,b=(d.addWash()?d.WASH_COST:0)+(d.addShine()&&d.addWash()?d.TIRE_SHINE_COST:0)+(d.addWax()&&d.addWash()?d.WAX_COST:0)+(d.addInterior()?d.INTERIOR_COST:0);return _.each(d.SelectedCars,function(c){var e=_.find(d.carSizes,function(a){return a.size==c.size||a.multiplier==c.multiplier});a+=e.multiplier*b}),a.toFixed(2)}),this.discountedTotal=ko.computed(function(){var a=d.orderTotal();if(!d.coupon())return a;var b=d.coupon().amount;return b>a?a=0:a-=b,a.toFixed(2)}),this.discountRemaining=ko.computed(function(){if(!d.coupon())return 0;var a=d.coupon().amount,b=a-d.orderTotal();return b<0?0:b.toFixed(2)}),this.orderSummary=ko.computed(function(){var a="";d.hideSubscriptionForm()?d.dateMoment&&(a=$.validator.format("<strong>{0} {1}</strong><br>",d.dateMoment.format("ddd MMM Do"),d.selectedTimeRange().range)):d.dateMoment&&(a=$.validator.format("<strong>{0} every {1} {2} starting {3}</strong><hr>",d.selectedTimeRange().range,d.selectedSubInterval(),d.selectedSubSpan().display,d.dateMoment.format("ddd MMM Do")));var b=d.SelectedCars;return b.length>0&&(a+=d._buildServicesSummary()+"<hr>"),b.forEach(function(b){var c=_.find(Configuration.CAR_SIZES,function(a){return a.size==b.size||a.multiplier==b.multiplier});a+=$.validator.format("<strong>{0} {1}</strong><br>{2}{3}<br>",b.make,b.model,c.size,c.multiplier>1?" - additional "+Math.round(100*(c.multiplier-1)).toString()+"%":"")}),a})}return _createClass(a,[{key:"SelectedCars",get:function(){return _.filter(this.cars(),function(a){return a.selected()})}}]),_createClass(a,[{key:"OnAfterRender",value:function(b,c){c.$addVehicleForm=$("#add-vehicle-form"),c.$addLocationForm=$("#add-location-form"),c.$contactDetailsForm=$("#contact-details-form"),c.$orderDetailsForm=$("#order-details-form"),$("#phone").mask("(999) 999-9999? ext:99999",{placeholder:" "}),$("#datetimepicker").datetimepicker({minDate:moment().subtract(1,"days"),maxDate:moment().add(60,"days"),format:Configuration.DATE_FORMAT,allowInputToggle:!0,focusOnShow:!1,ignoreReadonly:!0}).on("dp.change",c._onDatepickerChange.bind(c)),c._initValidation();try{var d;if(void 0!=URLSearchParams){var e=new URLSearchParams(window.location.search);d=e.get("coupon")}else for(var f=window.location.search.substring(1),g=f.split("&"),h=0;h<g.length;h++){var i=g[h].split("=");"coupon"==decodeURIComponent(i[0])&&(d=decodeURIComponent(i[1]))}d&&(d=d.trim().toUpperCase(),c.couponCode(d),c.$orderFormModal.modal("show"))}catch(a){console.log(a)}}},{key:"OnAddNewLocation",value:function(){this.showAddLocationForm(!0)}},{key:"OnCancelNewLocation",value:function(){this.$addVehicleForm.find("input").val(""),this.$addLocationForm.validate().resetForm(),this.showAddLocationForm(!1)}},{key:"OnSaveNewLocation",value:function(){if(this.$addLocationForm.valid()){var b=this._makeLocationSchema();_.each(this.locations(),function(a){return a.selected(!1)}),b.selected(!0),this.locations.push(b),this.$addLocationForm.find("input").val(""),this.showAddLocationForm(!1)}}},{key:"OnAddNewVehicle",value:function(){this.showAddVehicleForm(!0)}},{key:"OnCancelNewVehicle",value:function(){this.$addVehicleForm.find("input").val(""),this.$addVehicleForm.validate().resetForm(),this.showAddVehicleForm(!1)}},{key:"OnSaveNewVehicle",value:function(){if(this.$addVehicleForm.valid()){var b=this._makeCarSchema();b.selected(!0),this.cars.push(b),this.$addVehicleForm.find("input").val(""),this.showAddVehicleForm(!1)}}},{key:"OnClickVehiclePanel",value:function(b,c){c.selected(!c.selected())}},{key:"OnDeleteVehiclePanel",value:function(b,c){b.cars(_.reject(b.cars(),function(a){return _.isEqual(a,c)}))}},{key:"OnClickLocationPanel",value:function(b,c){_.each(b.locations(),function(a){a.selected(!1)}),c.selected(!0)}},{key:"OnDeleteLocationPanel",value:function(b,c){b.locations(_.reject(b.locations(),function(a){return _.isEqual(a,c)}))}},{key:"OnSubmit",value:function(b){if(!this.addWash()&&!this.addInterior())return this.incompleteFormMsg("Interior and/or exterior cleaning must be selected."),void $("#incomplete-form-alert").show();
if(!this.$orderDetailsForm.valid())return this.incompleteFormMsg("Please fill in required order details."),void $("#incomplete-form-alert").show();if(!this.cars()||0===this.cars().length)return this.incompleteFormMsg("Please add at least one vehicle."),void $("#incomplete-form-alert").show();if(0===this.SelectedCars.length)return this.incompleteFormMsg("Please select at least one vehicle to service."),void $("#incomplete-form-alert").show();if(!this.locations()||0===this.locations().length)return this.incompleteFormMsg("Please add a location."),void $("#incomplete-form-alert").show();var d=_.find(this.locations(),function(a){return a.selected()});return d?Utils.VerifyZip(d.zip)?this.$contactDetailsForm.valid()?($("#incomplete-form-alert").hide(),$("#invalid-coupon-alert").hide(),void(b?this._openCheckout():this._completeOrder())):(this.incompleteFormMsg("Please complete the contact information."),void $("#incomplete-form-alert").show()):(this.incompleteFormMsg("Sorry but we currently don't service within that zip code."),void $("#incomplete-form-alert").show()):(this.incompleteFormMsg("Please select your desired location."),void $("#incomplete-form-alert").show())}},{key:"OnFormCancel",value:function(){try{$("#incomplete-form-alert").hide(),$("#invalid-coupon-alert").hide(),$("#success-coupon-alert").hide(),this.$orderFormModal.modal("hide"),this.$orderDetailsForm.validate().resetForm(),this.$contactDetailsForm.validate().resetForm(),this.storageHelper.LoggedInUser=null,this.storageHelper.IsNewUser=!1,this.storageHelper.ZipCode="",this._resetObservables(),window.location="#page-top"}catch(a){console.log("Failed to reset fields OnFormCancel()"),console.log(a)}}},{key:"OnApplyCoupon",value:function(){var b=this;$("#invalid-coupon-alert").hide(),$("#success-coupon-alert").hide(),this.couponCode&&this.couponCode().length>0&&this.webSvc.VerifyCoupon(this.couponCode()).then(function(a){a?($("#success-coupon-alert").show(),b.coupon(a)):$("#invalid-coupon-alert").show()}).fail(function(a){console.log(a)})}},{key:"_openCheckout",value:function(){var b=parseInt(100*this.discountedTotal());this.stripeHandler.open({key:Configuration.StripeKey,name:"WMC Checkout",amount:b,zipCode:!0,email:this.email()})}},{key:"_completeOrder",value:function(b){try{var c=this,d=null!=b;spinner.Show(),async.waterfall([d?this._executeCharge.bind(this,b):function(a){a()},this._verifyUser.bind(this),this._updateUserData.bind(this,d),this._sendEmailConfirmation.bind(this)],function(a){a===Constants.CHARGE_FAILURE_MARKER?(c.incompleteFormMsg("That card information didn't work."),$("#incomplete-form-alert").show()):a?c._onOrderFailure(a):c._onOrderSuccess()})}catch(a){this._onOrderFailure(a)}}},{key:"_onOrderFailure",value:function(b){this.$orderFormModal.modal("hide"),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderFailure(),console.log(b)},200)}},{key:"_onOrderSuccess",value:function(){this.OnFormCancel(),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderSuccess()},200)}},{key:"_sendEmailConfirmation",value:function(b,c,d){this.webSvc.SendConfirmationEmail(b,c).then(function(){return d()}).fail(function(a){return d(a)})}},{key:"_verifyUser",value:function(b){var c=this;this.storageHelper.LoggedInUser?b(null,this.storageHelper.LoggedInUser):this.webSvc.GetUserByEmail(this.email()).then(function(a){if(a)b(null,a);else{var d=c._makeGuestUserSchema();c.webSvc.CreateUser(d).then(function(){return b(null,d)}).fail(function(a){return b(a)})}}).fail(function(a){return b(a)})}},{key:"_executeCharge",value:function(b,c){var d=parseInt(100*this.discountedTotal());this.webSvc.ExecuteCharge(b,d,this.last()).then(function(){return c()}).fail(function(a){console.log(a),c(Constants.CHARGE_FAILURE_MARKER)})}},{key:"_updateUserData",value:function(b,c,d){var e=this._makeAppointmentSchema(b);if(null!=c.appointments?c.appointments.push(e):c.appointments=[e],!this.hideSubscriptionForm()){var f=new Date(e.date),g=this._makeSubscriptionSchema(f);null!=c.subscriptions?c.subscriptions.push(g):c.subscriptions=[g]}c.cars=this.cars(),c.phone=this.phone(),c.locations=this.locations(),c.firstName=this.first(),c.lastName=this.last(),this.webSvc.UpdateUser(c).then(function(){return d(null,c.email,e)}).fail(function(a){return d(a)})}},{key:"_prePopulateUserData",value:function(){var b=this.storageHelper.LoggedInUser;if(b){var c=b.locations||[],d=b.cars||[];_.each(c,function(a){return a.selected=ko.observable(!1)}),_.each(d,function(a){return a.selected=ko.observable(!1)}),c.length>0&&c[0].selected(!0),d.length>0&&d[0].selected(!0),this.locations(c),this.cars(d),this.email(b.email||""),this.phone(b.phone||""),this.first(b.firstName||""),this.last(b.lastName||""),b.email&&this.disableEmailInput(!0),$("#phone").trigger("input")}this.showNewUserAlert(this.storageHelper.IsNewUser)}},{key:"_resetObservables",value:function(){this.showNewUserAlert(!1),this.disableEmailInput(!1),this.incompleteFormMsg(""),this.addWash(!0),this.addShine(!1),this.addWax(!1),this.addInterior(!1),this.description=ko.observable(""),this.selectedTimeRange(Constants.TIME_RANGE_PLACE_HOLDER),$("#datetimepicker").data("DateTimePicker").clear(),this.showAddVehicleForm(!1),this.cars([]),this.make(""),this.model(""),this.color(""),this.selectedCarSize(this.carSizes[0]),this.first(""),this.last(""),this.email(""),this.phone(""),this.showAddLocationForm(!1),this.locations([]),this.title(this.locationTitleOptions[0]),this.street(""),this.city(""),this.zip(""),this.couponCode(""),this.coupon(null)}},{key:"_onDatepickerChange",value:function(b){b&&b.date&&(this.dateMoment=b.date,this._updatePickerAndTimerangeOptions(b.date))}},{key:"_updatePickerAndTimerangeOptions",value:function(b){if(Utils.IsHoliday(b))return void _.each(this.timeRangeOptions,function(a){a.disabled(!0)});var c=moment().hour(),d=moment().format(Configuration.DATE_FORMAT),e=b.format(Configuration.DATE_FORMAT),f=this.storageHelper.AppointmentsByDate[e]||[],g=Configuration.MAX_JOB_TIME_PER_INTERVAL,h=_.filter(f,function(a){return a.timeRangeKey===Constants.MORNING_TIME_RANGE.key}),i=_.filter(f,function(a){return a.timeRangeKey===Constants.AFTERNOON_TIME_RANGE.key}),j=_.filter(f,function(a){return a.timeRangeKey===Constants.EVENING_TIME_RANGE.key}),k=_.filter(f,function(a){return a.timeRangeKey===Constants.NIGHT_TIME_RANGE.key});Constants.MORNING_TIME_RANGE.disabled(_.reduce(h,function(a,b){return a+b.timeEstimate},0)>g||e==d&&c>=9),Constants.AFTERNOON_TIME_RANGE.disabled(_.reduce(i,function(a,b){return a+b.timeEstimate},0)>g||e==d&&c>=12),Constants.EVENING_TIME_RANGE.disabled(_.reduce(j,function(a,b){return a+b.timeEstimate},0)>g||e==d&&c>=15),Constants.NIGHT_TIME_RANGE.disabled(_.reduce(k,function(a,b){return a+b.timeEstimate},0)>g||e==d&&c>=18),this.selectedTimeRange(Constants.TIME_RANGE_PLACE_HOLDER)}},{key:"_initValidation",value:function(){var b=this;$.validator.addMethod("timeRangeSelected",function(a,c,d){var e=b.selectedTimeRange().range;return null!=e&&e.length>0},"Please select a time range!"),this.$orderDetailsForm.validate({rules:{date:"required",timeRange:"timeRangeSelected"},errorPlacement:function(){}}),this.$contactDetailsForm.validate({rules:{first:"required",last:"required",date:"required",email:{required:!0,email:!0},phone:"required"},messages:{email:"Please enter a valid email address."}}),this.$addVehicleForm.validate({rules:{make:"required",model:"required",color:"required"}}),this.$addLocationForm.validate({rules:{street:"required",city:"required",zip:"required"}})}},{key:"_makeGuestUserSchema",value:function(){return{isGuest:!0,email:this.email(),pwd:Utils.GenerateUUID()}}},{key:"_makeCarSchema",value:function(){return{color:this.color(),make:this.make(),model:this.model(),size:this.selectedCarSize().size,selected:ko.observable(!1)}}},{key:"_makeAppointmentSchema",value:function(b){var c=this.SelectedCars,d=_.find(this.locations(),function(a){return a.selected()});return{cars:c,date:this.dateMoment.toDate(),location:d,prepaid:b,price:this.discountedTotal(),services:this._buildServicesArray(),timeEstimate:this._getTimeEstimate(),timeRange:this.selectedTimeRange().range,timeRangeKey:this.selectedTimeRange().key,description:this.description()}}},{key:"_makeSubscriptionSchema",value:function(b){for(var c=this.SlectedCars,d=_.find(this.locations(),function(a){return a.selected()}),e=this.selectedSubInterval()*this.selectedSubSpan().days,f=Math.round(365/e),g=e,h=[],i=0;i<f;i++){var j=new Date(b);j.setDate(b.getDate()+g),h.push(j),g+=e}return{cars:c,dates:h,location:d,price:this.orderTotal(),services:this._buildServicesArray(),timeEstimate:this._getTimeEstimate(),timeRange:this.selectedTimeRange().range,timeRangeKey:this.selectedTimeRange().key,description:this.description()}}},{key:"_makeLocationSchema",value:function(){return{city:this.city(),street:this.street(),title:this.title(),zip:this.zip(),selected:ko.observable(!1)}}},{key:"_getTimeEstimate",value:function(){var b=0;return this.addWash()&&(b+=Configuration.WASH_DETAILS.time),this.addShine()&&(b+=Configuration.TIRE_SHINE_DETAILS.time),this.addWax()&&(b+=Configuration.WAX_DETAILS.time),this.addInterior()&&(b+=Configuration.INTERIOR_DETAILS.time),b+=Configuration.AVG_JOB_SETUP_TIME,b+=Configuration.AVG_JOB_DRIVING_TIME}},{key:"_buildServicesArray",value:function(){var b=[];return this.addWash()&&b.push(Configuration.WASH_DETAILS.title),this.addShine()&&b.push(Configuration.TIRE_SHINE_DETAILS.title),this.addWax()&&b.push(Configuration.WAX_DETAILS.title),this.addInterior()&&b.push(Configuration.INTERIOR_DETAILS.title),b}},{key:"_buildServicesSummary",value:function(){var b="";return this.addWash()&&(b+=Configuration.WASH_DETAILS.title+"<br>"),this.addShine()&&(b+=Configuration.TIRE_SHINE_DETAILS.title+"<br>"),this.addWax()&&(b+=Configuration.WAX_DETAILS.title+"<br>"),this.addInterior()&&(b+=Configuration.INTERIOR_DETAILS.title+"<br>"),b}}]),a}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),WebService=function(){function a(){_classCallCheck(this,a),this.baseUrl=document.location.origin,this.deferred=null}return _createClass(a,[{key:"GetFutureAppointments",value:function(){return this._executeAjaxCall("GET","/api/getFutureApptDatesAndTimes")}},{key:"CreateUser",value:function(b){return this._executeAjaxCall("POST","/api/createNewUser",b)}},{key:"GetUserByEmail",value:function(b){return this._executeAjaxCall("POST","/api/getUserByEmail",{email:b})}},{key:"GetUserByEmailAndPwd",value:function(b,c){return this._executeAjaxCall("POST","/api/getUserByEmailAndPwd",{email:b,pwd:c})}},{key:"SendConfirmationEmail",value:function(b,c){return this._executeAjaxCall("POST","/api/sendConfirmationEmail",{email:b,newAppt:c})}},{key:"UpdateUser",value:function(b){return this._executeAjaxCall("PUT","/api/updateUser",b)}},{key:"ForgotPassword",value:function(b){return this._executeAjaxCall("POST","/api/forgotPassword",{email:b})}},{key:"GetEnvironment",value:function(){return this._executeAjaxCall("GET","/api/getEnvironment")}},{key:"GetSystemSettings",value:function(){return this._executeAjaxCall("GET","/api/getSystemSettings")}},{key:"ExecuteCharge",value:function(b,c,d){return this._executeAjaxCall("POST","/api/executeCharge",{stripeToken:b.id,price:c,lastName:d,email:b.email})}},{key:"VerifyCoupon",value:function(b){return this._executeAjaxCall("POST","/api/verifyCoupon",{code:b})}},{key:"SendGiftEmail",value:function(b,c){return this._executeAjaxCall("POST","/api/createOneTimeCoupon",{email:b,amount:c,duration:90})}},{key:"_executeAjaxCall",value:function(b,c,d){return this.deferred=$.Deferred(),$.ajax({url:this.baseUrl+c,type:b,contentType:"application/json; charset=UTF-8",dataType:"json",error:this._onError.bind(this),success:this._onSuccess.bind(this),timeout:1e4,data:JSON.stringify(d)}),this.deferred.promise()}},{key:"_onSuccess",value:function(b,c,d){if(console.info(b,c,d),this.deferred){var e=b?b.data:null;this.deferred.resolve(e)}}},{key:"_onError",value:function(b,c,d){console.error(b,c,d),this.deferred&&this.deferred.reject(d)}}]),a}();
