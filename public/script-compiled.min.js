"use strict"
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),spinner=null,environment="debug",dialogPresenter=null,Configuration={},Bootstrapper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"Run",value:function(){function e(){var e=$(this),t=e.find(".modal-dialog")
e.css("display","block"),t.css("margin-top",Math.max(0,($(window).height()-t.height())/2))}var t=$.Deferred(),i=null
spinner=new LoadingSpinner,dialogPresenter=new DialogPresenter,$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()}),$("body").scrollspy({target:".navbar-fixed-top"}),$(".modal").on("show.bs.modal",e),$(window).on("resize",function(){$(".modal:visible").each(e)})
var n="Application failed to initialize."
return async.series([function(e){$("#order-form-tmpl").load("./templates/order-form-tmpl.html",function(t,i,o){"error"===i?e(n):e()})},function(e){$("#gift-form-tmpl").load("./templates/gift-form-tmpl.html",function(t,i,o){"error"===i?e(n):e()})},function(e){$("#contact-modal-tmpl").load("./templates/contact-modal-tmpl.html",function(t,i,o){"error"===i?e(n):e()})},function(e){$("#login-modal-tmpl").load("./templates/login-modal-tmpl.html",function(t,i,o){"error"===i?e(n):e()})},function(e){$("#vehicle-tmpl").load("./templates/vehicle-tmpl.html",function(t,i,o){"error"===i?e(n):e()})},function(e){$("#location-tmpl").load("./templates/location-tmpl.html",function(t,i,o){"error"===i?e(n):e()})},function(e){i=new WebService,i.GetEnvironment().then(function(t){environment=t,e()}).fail(function(t){return e(t)})},function(e){i.GetSystemSettings().then(function(t){Configuration=new Configuration(t),e()}).fail(function(t){return e(t)})},function(e){var t=new LocalStorageHelper(sessionStorage),n=new OrderFormViewModel(t,i),o=new GiftFormViewModel(t,i),r=new LogInViewModel(t,i),a=new MainViewModel(t,r,n,o)
ko.applyBindings(a),i.GetFutureAppointments().then(function(i){var n=_.groupBy(i,function(e){return moment(e.date).format(Configuration.DATE_FORMAT)})
t.AppointmentsByDate=n,e()}).fail(function(t){e(t)})}],function(e){e?t.reject(e):t.resolve()}),t.promise()}}]),e}(),cbpAnimatedHeader=function(){function e(){window.addEventListener("scroll",function(e){r||(r=!0,setTimeout(t,250))},!1)}function t(){var e=i()
e>=a?classie.add(o,"navbar-shrink"):classie.remove(o,"navbar-shrink"),r=!1}function i(){return window.pageYOffset||n.scrollTop}var n=document.documentElement,o=document.querySelector(".navbar-default"),r=!1,a=300
e()}()
!function(e){function t(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")}function i(e,t){var i=n(e,t)?r:o
i(e,t)}var n,o,r
"classList"in document.documentElement?(n=function(e,t){return e.classList.contains(t)},o=function(e,t){e.classList.add(t)},r=function(e,t){e.classList.remove(t)}):(n=function(e,i){return t(i).test(e.className)},o=function(e,t){n(e,t)||(e.className=e.className+" "+t)},r=function(e,i){e.className=e.className.replace(t(i)," ")})
var a={hasClass:n,addClass:o,removeClass:r,toggleClass:i,has:n,add:o,remove:r,toggle:i}
"function"==typeof define&&define.amd?define(a):e.classie=a}(window)
var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Configuration=function(){function e(t){_classCallCheck(this,e),this.settings=t}return _createClass(e,[{key:"StripeKey",get:function(){return"production"==environment?"pk_live_aULtlGy6YPvc94K5Hjvqwokg":"pk_test_luqEThs0vblV173fgAHgPZBG"}},{key:"DATE_FORMAT",get:function(){return this.settings.DATE_FORMAT||"MM/DD/YY"}},{key:"DEFAULT_JOB_TIME_MINS",get:function(){return this.settings.DEFAULT_JOB_TIME_MINS||120}},{key:"MAX_JOB_TIME_PER_DAY_MINS",get:function(){return this.settings.MAX_JOB_TIME_PER_DAY_MINS||720}},{key:"MAX_JOB_TIME_PER_INTERVAL",get:function(){return this.settings.MAX_JOB_TIME_PER_INTERVAL||180}},{key:"AVG_JOB_DRIVING_TIME",get:function(){return this.settings.AVG_JOB_DRIVING_TIME||30}},{key:"AVG_JOB_SETUP_TIME",get:function(){return this.settings.JOB_SETUP_TIME||10}},{key:"SERVICES",get:function(){var e=this.settings.SERVICES||[{item:Constants.WASH,sortOrder:1,price:22,time:50,title:"Exterior Hand Wash",description:"We use an advanced eco-friendly hand washing technique to thoroughly remove contaminants from the wheels and surface of your vehicle!"},{item:Constants.TIRE_SHINE,sortOrder:2,price:8,time:20,title:"Tire Shine",description:"Make your car look new again with a hand applied gel coating that protects your tires from harmful UV rays and provides a beautiful shine."},{item:Constants.INTERIOR,sortOrder:3,price:45,time:45,title:"Interior Cleaning",description:"A clean interior means happy passengers. Add this service and we'll vacuum, spot remove stains, clean windows, and wipe down the dash, seats, door jambs, and trim!"},{item:Constants.WAX,sortOrder:4,price:32,time:45,title:"Hand Wax",description:"With this package we'll hand apply top of the line wax to your vehicle's body which provides extra shine and protection! We recommend waxing your vehicles every 3 to 6 months."},{item:Constants.SHAMPOO,sortOrder:6,price:50,time:60,title:"Carpet Shampoo",description:"Freshen your car's carpets with a deep clean and shampoo."},{item:Constants.CONDITIONER,sortOrder:7,price:50,time:60,title:"Shampoo/Condition Seats",description:"This service adds either a shampoo washing of fabric seats or a thorough conditioning of leather seats."},{item:Constants.HEADLIGHT_RESTORE,sortOrder:5,price:25,time:30,title:"Headlight Restore",description:"Foggy headlights? Tack on this service and we'll polish them up like new!"}],t=JSON.parse(JSON.stringify(e))
return t.forEach(function(e){e.item==Constants.WASH||e.item==Constants.INTERIOR?(e.checked=ko.observable(!0),e.disable=ko.observable(!1)):(e.checked=ko.observable(!1),e.disable=ko.observable(!1))}),_.sortBy(t,function(e){return e.sortOrder})}},{key:"CAR_SIZES",get:function(){return this.settings.CAR_SIZES||[{multiplier:1,size:"Compact (2-4 door)"},{multiplier:1.2,size:"Mid-Size"},{multiplier:1.4,size:"Large (SUV)"}]}},{key:"ZIP_WHITE_LIST",get:function(){return this.settings.ZIP_WHITE_LIST||["22314","22301","22305","22302","22304","22202","22206","22311","22312","22204","22041","22211","22201","22203","22209","22044","22151","22150","22152","22153","22015","22205","22042","22046","22003","22207","22213","22031","22043","22027","22101","22182","22030","22032","22039","20124"]}},{key:"SCHEDULE",get:function(){return this.settings.SCHEDULE||[{day:0,blockedTimeSlots:[]},{day:1,blockedTimeSlots:[]},{day:2,blockedTimeSlots:[]},{day:3,blockedTimeSlots:[]},{day:4,blockedTimeSlots:[]},{day:5,blockedTimeSlots:[]},{day:6,blockedTimeSlots:[]}]}},{key:"BLOCKED_DAYS",get:function(){return this.settings.BLOCKED_DAYS||[]}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),ASYNC_INTERUPTION_MARKER="ASYNC_INTERUPTION_MARKER",CHARGE_FAILURE_MARKER="CARD_CHARGE_FAILURE",MORNING_TIME_RANGE={range:"9:00 AM - 12:00 PM",key:1,disabled:ko.observable(!1)},AFTERNOON_TIME_RANGE={range:"12:00 - 3:00 PM",key:2,disabled:ko.observable(!1)},EVENING_TIME_RANGE={range:"3:00 - 6:00 PM",key:3,disabled:ko.observable(!1)},NIGHT_TIME_RANGE={range:"6:00 - 9:00 PM",key:4,disabled:ko.observable(!1)},TIME_RANGE_PLACE_HOLDER={range:"",disabled:ko.observable(!0)},WASH=1,TIRE_SHINE=2,INTERIOR=3,WAX=4,SHAMPOO=5,CONDITIONER=6,HEADLIGHT_RESTORE=7,Constants=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"MORNING_TIME_RANGE",get:function(){return MORNING_TIME_RANGE}},{key:"AFTERNOON_TIME_RANGE",get:function(){return AFTERNOON_TIME_RANGE}},{key:"EVENING_TIME_RANGE",get:function(){return EVENING_TIME_RANGE}},{key:"NIGHT_TIME_RANGE",get:function(){return NIGHT_TIME_RANGE}},{key:"ASYNC_INTERUPTION_MARKER",get:function(){return ASYNC_INTERUPTION_MARKER}},{key:"CHARGE_FAILURE_MARKER",get:function(){return CHARGE_FAILURE_MARKER}},{key:"TIME_RANGE_PLACE_HOLDER",get:function(){return TIME_RANGE_PLACE_HOLDER}},{key:"WASH",get:function(){return WASH}},{key:"TIRE_SHINE",get:function(){return TIRE_SHINE}},{key:"INTERIOR",get:function(){return INTERIOR}},{key:"WAX",get:function(){return WAX}},{key:"CONDITIONER",get:function(){return CONDITIONER}},{key:"SHAMPOO",get:function(){return SHAMPOO}},{key:"HEADLIGHT_RESTORE",get:function(){return HEADLIGHT_RESTORE}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),DialogPresenter=function(){function e(){_classCallCheck(this,e),this.title=ko.observable(""),this.body=ko.observable(""),this.$modal=$("#generic-modal")}return _createClass(e,[{key:"ShowOrderFailure",value:function(){this.title("Oh no :("),this.body("We're really sorry about this... Looks like there was a problem submitting your order. Please contact us for support."),this.$modal.modal("show")}},{key:"ShowOrderSuccess",value:function(){this.title("Thank you!"),this.body("Your order has been placed. Please check your email for confirmation."),this.$modal.modal("show")}},{key:"ShowBadZip",value:function(){this.title("Darn! We don't service that area yet."),this.body(s.sprintf("We're still young and growing so check back soon. Feel free to               <a href=%s>contact us</a> so we know where to target next.","javascript:$('.modal').removeClass('fade');$('.modal').modal('hide');$('#contact-modal').modal('show');$('.modal').addClass('fade');")),this.$modal.modal("show")}}]),e}()
window.jQuery(document).ready(function(e){try{Bootstrapper.Run().fail(function(t){console.error(t),e("#splash").removeAttr("hidden").append("<div><h3>Website is under maintenance. We apologize for the inconvenience</h3></div>")})}catch(t){console.error(t)}})
var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),LocalStorageHelper=function(){function e(t){_classCallCheck(this,e)
try{t.test="test",this.storageType=t}catch(i){console.info("No local storage available. Using memory..."),this.storageType={}}}return _createClass(e,[{key:"ZipCode",get:function(){return this.storageType&&this.storageType.zip?this.storageType.zip:""},set:function(e){this.storageType&&(this.storageType.zip=e)}},{key:"AppointmentsByDate",get:function(){return this.storageType&&this.storageType.appointments?JSON.parse(this.storageType.appointments):[]},set:function(e){this.storageType&&(this.storageType.appointments=JSON.stringify(e))}},{key:"LoggedInUser",get:function(){return this.storageType&&this.storageType.loggedInUser?JSON.parse(this.storageType.loggedInUser):null},set:function(e){this.storageType&&(this.storageType.loggedInUser=JSON.stringify(e))}},{key:"IsNewUser",get:function(){return this.storageType&&this.storageType.isNewUser?JSON.parse(this.storageType.isNewUser):!1},set:function(e){this.storageType&&(this.storageType.isNewUser=JSON.stringify(e))}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),LoadingSpinner=function(){function e(){_classCallCheck(this,e)
var t=12,i=12,n=30,o=t+i+n
this.spinner=null,this.options={lines:13,length:i,width:t,radius:n,scale:1,corners:1,color:"#0076A3",opacity:.35,rotate:0,direction:1,speed:.8,trail:45,fps:20,zIndex:2e9,className:"spinner",top:"-"+o.toString(),left:"-"+o.toString(),shadow:!0,hwaccel:!0,position:"relative"},this.spinnerOverlay=$("#page-load-spinner"),this.spinnerContainer=document.getElementById("spinner-container")}return _createClass(e,[{key:"Show",value:function(){$(this.spinnerOverlay).is(":visible")||(this.spinnerOverlay.show(),this.spinner?this.spinner.spin(this.spinnerContainer):this.spinner=new Spinner(this.options).spin(this.spinnerContainer))}},{key:"Hide",value:function(){this.spinnerOverlay.hide(),this.spinner&&this.spinner.stop()}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Utils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"GetListOfDisabledDates",value:function(e){if(!e)return[]
var t=[]
for(var i in e)if(e.hasOwnProperty(i)){var n=0,o=e[i]
_.each(o,function(e){n+=e.timeEstimate?e.timeEstimate:Configuration.DEFAULT_JOB_TIME_MINS}),n>Configuration.MAX_JOB_TIME_PER_DAY_MINS&&t.push(_.first(o).date)}return t}},{key:"VerifyZip",value:function(e){return _.contains(Configuration.ZIP_WHITE_LIST,e.trim())}},{key:"IsStrEqual",value:function(e,t){var i=e.trim().toUpperCase(),n=t.trim().toUpperCase()
return i===n}},{key:"GenerateUUID",value:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0
return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)})
return t}},{key:"IsHoliday",value:function(e){var t={M:{"01/01":"New Year's Day","07/04":"Independence Day","11/11":"Veteran's Day","12/24":"Christmas Eve","12/25":"Christmas Day","12/31":"New Year's Eve"},W:{"1/3/1":"Martin Luther King Jr. Day","2/3/1":"Washington's Birthday","5/5/1":"Memorial Day","9/1/1":"Labor Day","10/2/1":"Columbus Day","11/4/4":"Thanksgiving Day"}},i=e.toDate(),n=1+(0|(i.getDate()-1)/7),o=1===i.getDay()&&i.getDate()+7>30?"5":null
return t.M[e.format("MM/DD")]||t.W[e.format("M/"+(o||n)+"/d")]}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),GiftFormViewModel=function(){function e(t,i){var n=this
_classCallCheck(this,e)
var o=this
this.stripeHandler=StripeCheckout.configure({key:Configuration.StripeKey,image:"/img/square_logo.png",locale:"auto",token:this._completeOrder.bind(this)}),$(window).on("popstate",function(){o.stripeHandler.close()}),this.storageHelper=t,this.webSvc=i,this.$giftFormModal=$("#gift-form-modal"),this.incompleteGiftMsg=ko.observable(""),this.Services=ko.observableArray(Configuration.SERVICES),this.addWash=ko.computed(function(){return _.find(n.Services(),function(e){return e.item==Constants.WASH}).checked()}),this.addInterior=ko.computed(function(){return _.find(n.Services(),function(e){return e.item==Constants.INTERIOR}).checked()}),this.addWash.subscribe(function(e){n.Services().forEach(function(t){t.item!=Constants.TIRE_SHINE&&t.item!=Constants.WAX||t.disable(!e)})}),this.addInterior.subscribe(function(e){n.Services().forEach(function(t){t.item!=Constants.SHAMPOO&&t.item!=Constants.CONDITIONER&&t.item!=Constants.HEADLIGHT_RESTORE||t.disable(!e)})}),this.Rows=_.partition(this.Services(),function(e){return e.sortOrder<=Math.ceil(n.Services().length/2)}),this.carSizes=Configuration.CAR_SIZES,this.selectedCarSize=ko.observable(this.carSizes[0]),this.email=ko.observable(""),this.zip=ko.observable(this.storageHelper.ZipCode),this.orderTotal=ko.computed(function(){var e=0,t=_.reduce(n.Services(),function(e,t){return t.checked()&&!t.disable()&&(e+=t.price),e},0)
return e+=o.selectedCarSize().multiplier*t,e.toFixed(2)}),this.orderSummary=ko.computed(function(){var e=""
return e+=o._buildServicesSummary()+"<hr>",e+=$.validator.format("<strong>{0}</strong>{1}<br>",o.selectedCarSize().size,o.selectedCarSize().multiplier>1?" - additional "+Math.round(100*(o.selectedCarSize().multiplier-1)).toString()+"%":"")})}return _createClass(e,[{key:"OnAfterRender",value:function(e,t){t.$giftForm=$("#gift-form"),t._initValidation()}},{key:"OnSubmit",value:function(){return this.addWash()||this.addInterior()?this.$giftForm.valid()?Utils.VerifyZip(this.zip())?($("#incomplete-gift-alert").hide(),void this._openCheckout()):(this.incompleteGiftMsg("Sorry but we currently don't service within that zip code."),void $("#incomplete-gift-alert").show()):(this.incompleteGiftMsg("Please fill in required details."),void $("#incomplete-gift-alert").show()):(this.incompleteGiftMsg("Interior and/or exterior cleaning must be selected."),void $("#incomplete-gift-alert").show())}},{key:"OnFormCancel",value:function(){try{$("#incomplete-gift-alert").hide(),this.$giftFormModal.modal("hide"),this.$giftForm.validate().resetForm(),this._resetObservables(),window.location="#page-top"}catch(e){console.log("Failed to reset fields OnFormCancel()"),console.log(e)}}},{key:"_openCheckout",value:function(){var e=parseInt(100*this.orderTotal())
this.stripeHandler.open({key:Configuration.StripeKey,name:"WMC Checkout",amount:e,zipCode:!0,email:this.email()})}},{key:"_completeOrder",value:function(e){try{var t=this
spinner.Show(),async.waterfall([this._executeCharge.bind(this,e),this._sendGiftConfirmation.bind(this)],function(e){e===Constants.CHARGE_FAILURE_MARKER?(t.incompleteGiftMsg("That card information didn't work."),$("#incomplete-gift-alert").show()):e?t._onOrderFailure(e):t._onOrderSuccess()})}catch(i){this._onOrderFailure(i)}}},{key:"_onOrderFailure",value:function(e){this.$giftFormModal.modal("hide"),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderFailure(),console.log(e)},200)}},{key:"_onOrderSuccess",value:function(){this.OnFormCancel(),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderSuccess()},200)}},{key:"_sendGiftConfirmation",value:function(e){this.webSvc.SendGiftEmail(this.email(),this.orderTotal()).then(function(){return e()}).fail(function(t){return e(t)})}},{key:"_executeCharge",value:function(e,t){var i=parseInt(100*this.orderTotal())
this.webSvc.ExecuteCharge(e,i).then(function(){return t()}).fail(function(e){console.log(e),t(Constants.CHARGE_FAILURE_MARKER)})}},{key:"_resetObservables",value:function(){this.incompleteGiftMsg(""),this.Services().forEach(function(e){return e.checked(!1)}),this.selectedCarSize(this.carSizes[0]),this.email(""),this.zip("")}},{key:"_initValidation",value:function(){this.$giftForm.validate({rules:{zip:"required",email:{required:!0,email:!0}},messages:{email:"Please enter a valid email address."}})}},{key:"_buildServicesSummary",value:function(){var e=""
return this.Services().forEach(function(t){t.checked()&&!t.disable()&&(e+=t.title+"<br>")}),e}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),LogInViewModel=function(){function e(t,i){_classCallCheck(this,e),this.storageHelper=t,this.webSvc=i,this.$loginModal=$("#login-modal"),this.$orderFormModal=$("#order-form-modal"),this.$loginForm=$("#login-form"),this.$createAcctForm=$("#create-acct-form"),this.$forgotPwdForm=$("#forgot-pwd-form"),this.$loginFormAlert=$("#login-form-alert"),this.$loginFormInfo=$("#login-form-info"),this.ShowLogin=ko.observable(!0),this.ShowCreateAcct=ko.observable(!1),this.ShowForgotPwd=ko.observable(!1),this.loginFormMsg=ko.observable(""),this.email=ko.observable(),this.pwd=ko.observable(),this.firstName=ko.observable(""),this.lastName=ko.observable(""),this.phone=ko.observable(""),this.verifyPwd=ko.observable(""),this.verifyEmail=ko.observable(""),this._initValidation()}return _createClass(e,[{key:"OnDismissMsg",value:function(){this.$loginFormAlert.hide(),this.$loginFormInfo.hide()}},{key:"OnContinueAsGuest",value:function(){this.storageHelper.LoggedInUser=null,this.storageHelper.IsNewUser=!1,this.OnDismissMsg(),this._resetForms(),this._toggleModals()}},{key:"OnShowCreateAcct",value:function(){this._resetForms(),this.ShowForgotPwd(!1),this.ShowLogin(!1),this.ShowCreateAcct(!0),this.OnDismissMsg()}},{key:"OnCancelCreateAcct",value:function(){this._resetForms(),this.ShowForgotPwd(!1),this.ShowCreateAcct(!1),this.ShowLogin(!0),this.OnDismissMsg()}},{key:"OnCreateAcct",value:function(){var e=this
this.$createAcctForm.valid()&&(spinner.Show(),async.series([this._checkIfUserExists.bind(this),this._createNewUser.bind(this)],function(t){spinner.Hide(),t===Constants.ASYNC_INTERUPTION_MARKER?(e.loginFormMsg("That email is already in use! Did you forget your password?"),e.$loginFormAlert.show()):t?(e.loginFormMsg("There was a problem creating your account."),e.$loginFormAlert.show()):(e.storageHelper.IsNewUser=!0,e.OnCancelCreateAcct(),e._toggleModals())}))}},{key:"OnLogIn",value:function(){var e=this
this.$loginForm.valid()&&(spinner.Show(),this.webSvc.GetUserByEmailAndPwd(this.email(),this.pwd()).then(function(t){t?(e.storageHelper.LoggedInUser=t,e.storageHelper.IsNewUser=!1,e._resetForms(),e._toggleModals()):(e.loginFormMsg("Hmmm, we didn't find an account matching those credentials. 							Please verify your info and try again or click 'Forgot Password'."),e.$loginFormAlert.show(),e._resetForms())}).fail(function(t){e._resetForms(),e.loginFormMsg("Uh oh... something went wrong."),e.$loginFormAlert.show()}).always(function(){return spinner.Hide()}))}},{key:"OnShowForgotPwd",value:function(){this._resetForms(),this.ShowLogin(!1),this.ShowCreateAcct(!1),this.ShowForgotPwd(!0),this.OnDismissMsg()}},{key:"OnCancelForgotPwd",value:function(){this._resetForms(),this.ShowCreateAcct(!1),this.ShowForgotPwd(!1),this.ShowLogin(!0),this.OnDismissMsg()}},{key:"OnSubmitForgotPwd",value:function(){if(this.$forgotPwdForm.valid()){var e=this
spinner.Show(),this.webSvc.ForgotPassword(this.email()).then(function(){e.loginFormMsg("Nice! Check your email ;)"),e.$loginFormInfo.show(),e._resetForms(),e.ShowCreateAcct(!1),e.ShowForgotPwd(!1),e.ShowLogin(!0)}).fail(function(t){e.loginFormMsg("Uh oh... something went wrong."),e.$loginFormAlert.show(),console.log(t),e._resetForms()}).always(function(){return spinner.Hide()})}}},{key:"_checkIfUserExists",value:function(e){this.webSvc.GetUserByEmail(this.email()).then(function(t){t&&!t.isGuest?e(Constants.ASYNC_INTERUPTION_MARKER):e()}).fail(function(t){e(t)})}},{key:"_createNewUser",value:function(e){var t=this,i={email:this.email(),pwd:this.pwd(),isGuest:!1}
this.webSvc.CreateUser(i).then(function(i){t.storageHelper.LoggedInUser=i,e()}).fail(function(t){e(t)})}},{key:"_resetForms",value:function(){this.$loginForm.find("input").val(""),this.$loginForm.validate().resetForm(),this.$createAcctForm.find("input").val(""),this.$createAcctForm.validate().resetForm(),this.$forgotPwdForm.find("input").val(""),this.$forgotPwdForm.validate().resetForm()}},{key:"_toggleModals",value:function(){this.$loginModal.removeClass("fade"),this.$loginModal.modal("hide"),this.$loginModal.addClass("fade"),this.$orderFormModal.modal("show")}},{key:"_initValidation",value:function(){var e=this
$.validator.addMethod("pwdLength",function(e){return e&&e.length>=6}),$.validator.addMethod("pwdEqual",function(){return e.pwd()===e.verifyPwd()},"Passwords do not match!"),$.validator.addMethod("emailEqual",function(){return Utils.IsStrEqual(e.email(),e.verifyEmail())},"Emails do not match!"),this.$createAcctForm.validate({rules:{email:{required:!0,email:!0},verifyEmail:{required:!0,emailEqual:!0},pwd:{required:!0,pwdLength:!0},verifyPwd:{required:!0,pwdEqual:!0}},messages:{email:"Please enter a valid email address.",pwd:"Password must be at least 6 characters."}}),this.$loginForm.validate({rules:{email:{required:!0,email:!0},pwd:"required"},messages:{email:"Please enter a valid email address.",pwd:"Password required."}}),this.$forgotPwdForm.validate({rules:{email:{required:!0,email:!0},verifyEmail:{required:!0,emailEqual:!0}},messages:{email:"Please enter a valid email address."}})}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),MainViewModel=function(){function e(t,i,n,o){_classCallCheck(this,e),this.Services=Configuration.SERVICES,this.WASH_COST=_.find(this.Services,function(e){return e.item==Constants.WASH}).price,this.Services.length%2!=0&&(_.last(this.Services).fullSpan="col-md-12"),this.LogInViewModel=i,this.OrderFormViewModel=n,this.GiftFormViewModel=o,this.storageHelper=t,this.zip=ko.observable(""),this.storageHelper.ZipCode?this.zipVerified=ko.observable(!0):this.zipVerified=ko.observable(!1)}return _createClass(e,[{key:"DialogPresenter",get:function(){return dialogPresenter}}]),_createClass(e,[{key:"OnPageScroll",value:function(e,t){var i=$(t.currentTarget)
$("html, body").stop().animate({scrollTop:$(i.attr("href")).offset().top},1500,"easeInOutExpo"),t.preventDefault()}},{key:"OnVerifyZip",value:function(){Utils.VerifyZip(this.zip())?(this.zipVerified(!0),this.storageHelper.ZipCode=this.zip()):(dialogPresenter.ShowBadZip(),this.zip(""))}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),OrderFormViewModel=function(){function e(t,i){var n=this
_classCallCheck(this,e)
var o=this
this.stripeHandler=StripeCheckout.configure({key:Configuration.StripeKey,image:"/img/square_logo.png",locale:"auto",token:this._completeOrder.bind(this)}),$(window).on("popstate",function(){o.stripeHandler.close()}),this.webSvc=i,this.storageHelper=t,this.$orderFormModal=$("#order-form-modal"),this.$orderFormModal.on("show.bs.modal",function(){o._prePopulateUserData()}),this.disableEmailInput=ko.observable(!1),this.incompleteFormMsg=ko.observable(""),this.showNewUserAlert=ko.observable(!1),this.Services=ko.observableArray(Configuration.SERVICES),this.addWash=ko.computed(function(){return _.find(n.Services(),function(e){return e.item==Constants.WASH}).checked()}),this.addInterior=ko.computed(function(){return _.find(n.Services(),function(e){return e.item==Constants.INTERIOR}).checked()}),this.addWash.subscribe(function(e){n.Services().forEach(function(t){t.item!=Constants.TIRE_SHINE&&t.item!=Constants.WAX||t.disable(!e)})}),this.addInterior.subscribe(function(e){n.Services().forEach(function(t){t.item!=Constants.SHAMPOO&&t.item!=Constants.CONDITIONER&&t.item!=Constants.HEADLIGHT_RESTORE||t.disable(!e)})}),this.Rows=_.partition(this.Services(),function(e){return e.sortOrder<=Math.ceil(n.Services().length/2)}),this.description=ko.observable(""),this.timeRangeOptions=[Constants.TIME_RANGE_PLACE_HOLDER,Constants.MORNING_TIME_RANGE,Constants.AFTERNOON_TIME_RANGE,Constants.EVENING_TIME_RANGE],this.selectedTimeRange=ko.observable(Constants.TIME_RANGE_PLACE_HOLDER),this.dateMoment=null,this.showAddVehicleForm=ko.observable(!1),this.cars=ko.observableArray([]),this.make=ko.observable(""),this.model=ko.observable(""),this.color=ko.observable(""),this.carSizes=Configuration.CAR_SIZES,this.selectedCarSize=ko.observable(this.carSizes[0]),this.first=ko.observable(""),this.last=ko.observable(""),this.email=ko.observable(""),this.phone=ko.observable(""),this.showAddLocationForm=ko.observable(!1),this.locations=ko.observableArray([]),this.locationTitleOptions=["Home","Work","Other"],this.title=ko.observable(this.locationTitleOptions[0]),this.street=ko.observable(""),this.city=ko.observable(""),this.zip=ko.observable(this.storageHelper.ZipCode),this.couponCode=ko.observable(""),this.coupon=ko.observable(null),this.orderTotal=ko.computed(function(){var e=0,t=_.reduce(n.Services(),function(e,t){return t.checked()&&!t.disable()&&(e+=t.price),e},0)
return _.each(o.SelectedCars,function(i){var n=_.find(o.carSizes,function(e){return e.size==i.size||e.multiplier==i.multiplier})
e+=n.multiplier*t}),e.toFixed(2)}),this.discountedTotal=ko.computed(function(){var e=o.orderTotal()
if(!o.coupon())return e
var t=o.coupon().amount
return t>e?e=0:e-=t,e.toFixed(2)}),this.discountRemaining=ko.computed(function(){if(!o.coupon())return 0
var e=o.coupon().amount,t=e-o.orderTotal()
return 0>t?0:t.toFixed(2)}),this.orderSummary=ko.computed(function(){var e=""
o.dateMoment&&(e=$.validator.format("<strong>{0} {1}</strong><br>",o.dateMoment.format("ddd MMM Do"),o.selectedTimeRange().range))
var t=o.SelectedCars
return t.length>0&&(e+=o._buildServicesSummary()+"<hr>"),t.forEach(function(t){var i=_.find(Configuration.CAR_SIZES,function(e){return e.size==t.size||e.multiplier==t.multiplier})
e+=$.validator.format("<strong>{0} {1}</strong><br>{2}{3}<br>",t.make,t.model,i.size,i.multiplier>1?" - additional "+Math.round(100*(i.multiplier-1)).toString()+"%":"")}),e})}return _createClass(e,[{key:"SelectedCars",get:function(){return _.filter(this.cars(),function(e){return e.selected()})}}]),_createClass(e,[{key:"OnAfterRender",value:function(e,t){t.$addVehicleForm=$("#add-vehicle-form"),t.$addLocationForm=$("#add-location-form"),t.$contactDetailsForm=$("#contact-details-form"),t.$orderDetailsForm=$("#order-details-form"),$("#phone").mask("(999) 999-9999? ext:99999",{placeholder:" "}),$("#datetimepicker").datetimepicker({minDate:moment().subtract(1,"days"),maxDate:moment().add(30,"days"),format:Configuration.DATE_FORMAT,disabledDates:Configuration.BLOCKED_DAYS,allowInputToggle:!0,focusOnShow:!1,ignoreReadonly:!0}).on("dp.change",t._onDatepickerChange.bind(t)),t._initValidation()
try{var i
if(void 0!=URLSearchParams){var n=new URLSearchParams(window.location.search)
i=n.get("coupon")}else for(var o=window.location.search.substring(1),r=o.split("&"),a=0;a<r.length;a++){var s=r[a].split("=")
"coupon"==decodeURIComponent(s[0])&&(i=decodeURIComponent(s[1]))}i&&(i=i.trim().toUpperCase(),t.couponCode(i),t.$orderFormModal.modal("show"))}catch(l){console.log(l)}}},{key:"OnAddNewLocation",value:function(){this.showAddLocationForm(!0)}},{key:"OnCancelNewLocation",value:function(){this.$addVehicleForm.find("input").val(""),this.$addLocationForm.validate().resetForm(),this.showAddLocationForm(!1)}},{key:"OnSaveNewLocation",value:function(){if(this.$addLocationForm.valid()){var e=this._makeLocationSchema()
_.each(this.locations(),function(e){return e.selected(!1)}),e.selected(!0),this.locations.push(e),this.$addLocationForm.find("input").val(""),this.showAddLocationForm(!1)}}},{key:"OnAddNewVehicle",value:function(){this.showAddVehicleForm(!0)}},{key:"OnCancelNewVehicle",value:function(){this.$addVehicleForm.find("input").val(""),this.$addVehicleForm.validate().resetForm(),this.showAddVehicleForm(!1)}},{key:"OnSaveNewVehicle",value:function(){if(this.$addVehicleForm.valid()){var e=this._makeCarSchema()
e.selected(!0),this.cars.push(e),this.$addVehicleForm.find("input").val(""),this.showAddVehicleForm(!1)}}},{key:"OnClickVehiclePanel",value:function(e,t){t.selected(!t.selected())}},{key:"OnDeleteVehiclePanel",value:function(e,t){e.cars(_.reject(e.cars(),function(e){return _.isEqual(e,t)}))}},{key:"OnClickLocationPanel",value:function(e,t){_.each(e.locations(),function(e){e.selected(!1)}),t.selected(!0)}},{key:"OnDeleteLocationPanel",value:function(e,t){e.locations(_.reject(e.locations(),function(e){return _.isEqual(e,t)}))}},{key:"OnSubmit",value:function(e){if(!this.addWash()&&!this.addInterior())return this.incompleteFormMsg("Interior and/or exterior cleaning must be selected."),void $("#incomplete-form-alert").show()
if(!this.$orderDetailsForm.valid())return this.incompleteFormMsg("Please fill in required order details."),void $("#incomplete-form-alert").show()
if(!this.cars()||0===this.cars().length)return this.incompleteFormMsg("Please add at least one vehicle."),void $("#incomplete-form-alert").show()
if(0===this.SelectedCars.length)return this.incompleteFormMsg("Please select at least one vehicle to service."),void $("#incomplete-form-alert").show()
if(!this.locations()||0===this.locations().length)return this.incompleteFormMsg("Please add a location."),void $("#incomplete-form-alert").show()
var t=_.find(this.locations(),function(e){return e.selected()})
return t?Utils.VerifyZip(t.zip)?this.$contactDetailsForm.valid()?($("#incomplete-form-alert").hide(),$("#invalid-coupon-alert").hide(),void(e?this._openCheckout():this._completeOrder())):(this.incompleteFormMsg("Please complete the contact information."),void $("#incomplete-form-alert").show()):(this.incompleteFormMsg("Sorry but we currently don't service within that zip code."),void $("#incomplete-form-alert").show()):(this.incompleteFormMsg("Please select your desired location."),void $("#incomplete-form-alert").show())}},{key:"OnFormCancel",value:function(){try{$("#incomplete-form-alert").hide(),$("#invalid-coupon-alert").hide(),$("#success-coupon-alert").hide(),this.$orderFormModal.modal("hide"),this.$orderDetailsForm.validate().resetForm(),this.$contactDetailsForm.validate().resetForm(),this.storageHelper.LoggedInUser=null,this.storageHelper.IsNewUser=!1,this.storageHelper.ZipCode="",this._resetObservables(),window.location="#page-top"}catch(e){console.log("Failed to reset fields OnFormCancel()"),console.log(e)}}},{key:"OnApplyCoupon",value:function(){var e=this
$("#invalid-coupon-alert").hide(),$("#success-coupon-alert").hide(),this.couponCode&&this.couponCode().length>0&&this.webSvc.VerifyCoupon(this.couponCode()).then(function(t){t?($("#success-coupon-alert").show(),e.coupon(t)):$("#invalid-coupon-alert").show()}).fail(function(e){console.log(e)})}},{key:"_openCheckout",value:function(){var e=parseInt(100*this.discountedTotal())
this.stripeHandler.open({key:Configuration.StripeKey,name:"WMC Checkout",amount:e,zipCode:!0,email:this.email()})}},{key:"_completeOrder",value:function(e){try{var t=this,i=null!=e
spinner.Show(),async.waterfall([i?this._executeCharge.bind(this,e):function(e){e()},this._verifyUser.bind(this),this._updateUserData.bind(this,i),this._sendEmailConfirmation.bind(this)],function(e){e===Constants.CHARGE_FAILURE_MARKER?(t.incompleteFormMsg("That card information didn't work."),$("#incomplete-form-alert").show()):e?t._onOrderFailure(e):t._onOrderSuccess()})}catch(n){this._onOrderFailure(n)}}},{key:"_onOrderFailure",value:function(e){this.$orderFormModal.modal("hide"),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderFailure(),console.log(e)},200)}},{key:"_onOrderSuccess",value:function(){this.OnFormCancel(),setTimeout(function(){spinner.Hide(),dialogPresenter.ShowOrderSuccess()},200)}},{key:"_sendEmailConfirmation",value:function(e,t,i){this.webSvc.SendConfirmationEmail(e.firstName,e.email,e.phone,t).then(function(){return i()}).fail(function(e){return i(e)})}},{key:"_verifyUser",value:function(e){var t=this
this.storageHelper.LoggedInUser?e(null,this.storageHelper.LoggedInUser):this.webSvc.GetUserByEmail(this.email()).then(function(i){if(i)e(null,i)
else{var n=t._makeGuestUserSchema()
t.webSvc.CreateUser(n).then(function(){return e(null,n)}).fail(function(t){return e(t)})}}).fail(function(t){return e(t)})}},{key:"_executeCharge",value:function(e,t){var i=parseInt(100*this.discountedTotal())
this.webSvc.ExecuteCharge(e,i,this.last()).then(function(){return t()}).fail(function(e){console.log(e),t(Constants.CHARGE_FAILURE_MARKER)})}},{key:"_updateUserData",value:function(e,t,i){var n=this._makeAppointmentSchema(e)
null!=t.appointments?t.appointments.push(n):t.appointments=[n],t.cars=this.cars(),t.phone=this.phone(),t.locations=this.locations(),t.firstName=this.first(),t.lastName=this.last(),this.webSvc.UpdateUser(t).then(function(){return i(null,t,n)}).fail(function(e){return i(e)})}},{key:"_prePopulateUserData",value:function(){var e=this.storageHelper.LoggedInUser
if(e){var t=e.locations||[],i=e.cars||[]
_.each(t,function(e){return e.selected=ko.observable(!1)}),_.each(i,function(e){return e.selected=ko.observable(!1)}),t.length>0&&t[0].selected(!0),i.length>0&&i[0].selected(!0),this.locations(t),this.cars(i),this.email(e.email||""),this.phone(e.phone||""),this.first(e.firstName||""),this.last(e.lastName||""),e.email&&this.disableEmailInput(!0),$("#phone").trigger("input")}this.showNewUserAlert(this.storageHelper.IsNewUser)}},{key:"_resetObservables",value:function(){this.showNewUserAlert(!1),this.disableEmailInput(!1),this.incompleteFormMsg(""),this.description=ko.observable(""),this.selectedTimeRange(Constants.TIME_RANGE_PLACE_HOLDER),$("#datetimepicker").data("DateTimePicker").clear(),this.showAddVehicleForm(!1),this.cars([]),this.make(""),this.model(""),this.color(""),this.selectedCarSize(this.carSizes[0]),this.first(""),this.last(""),this.email(""),this.phone(""),this.showAddLocationForm(!1),this.locations([]),this.title(this.locationTitleOptions[0]),this.street(""),this.city(""),this.zip(""),this.couponCode(""),this.coupon(null)}},{key:"_onDatepickerChange",value:function(e){e&&e.date&&(this.dateMoment=e.date,this._updatePickerAndTimerangeOptions(e.date))}},{key:"_updatePickerAndTimerangeOptions",value:function(e){if(Utils.IsHoliday(e))return _.each(this.timeRangeOptions,function(e){e.disabled(!0)}),void this.selectedTimeRange(Constants.TIME_RANGE_PLACE_HOLDER)
var t=moment().hour(),i=moment().format(Configuration.DATE_FORMAT),n=moment().add(1,"day").format(Configuration.DATE_FORMAT),o=e.format(Configuration.DATE_FORMAT),r=e.day(),a=_.find(Configuration.SCHEDULE,function(e){return e.day===r}),s=this.storageHelper.AppointmentsByDate[o]||[],l=Configuration.MAX_JOB_TIME_PER_INTERVAL,c=_.filter(s,function(e){return e.timeRangeKey===Constants.MORNING_TIME_RANGE.key}),u=_.filter(s,function(e){return e.timeRangeKey===Constants.AFTERNOON_TIME_RANGE.key}),d=_.filter(s,function(e){return e.timeRangeKey===Constants.EVENING_TIME_RANGE.key}),h=_.filter(s,function(e){return e.timeRangeKey===Constants.NIGHT_TIME_RANGE.key})
Constants.MORNING_TIME_RANGE.disabled(_.reduce(c,function(e,t){return e+t.timeEstimate},0)>=l||o==i&&t>=1||o==n&&t>=20||_.contains(a.blockedTimeSlots,Constants.MORNING_TIME_RANGE.key)),Constants.AFTERNOON_TIME_RANGE.disabled(_.reduce(u,function(e,t){return e+t.timeEstimate},0)>=l||o==i&&t>=9||o==n&&t>=20||_.contains(a.blockedTimeSlots,Constants.AFTERNOON_TIME_RANGE.key)),Constants.EVENING_TIME_RANGE.disabled(_.reduce(d,function(e,t){return e+t.timeEstimate},0)>=l||o==i&&t>=12||_.contains(a.blockedTimeSlots,Constants.EVENING_TIME_RANGE.key)),Constants.NIGHT_TIME_RANGE.disabled(_.reduce(h,function(e,t){return e+t.timeEstimate},0)>=l||o==i&&t>=15||_.contains(a.blockedTimeSlots,Constants.NIGHT_TIME_RANGE.key)),this.selectedTimeRange().disabled()&&this.selectedTimeRange(Constants.TIME_RANGE_PLACE_HOLDER)}},{key:"_initValidation",value:function(){var e=this
$.validator.addMethod("timeRangeSelected",function(t,i,n){var o=e.selectedTimeRange().range
return null!=o&&o.length>0},"Please select a time range!"),this.$orderDetailsForm.validate({rules:{date:"required",timeRange:"timeRangeSelected"},errorPlacement:function(){}}),this.$contactDetailsForm.validate({rules:{first:"required",last:"required",date:"required",email:{required:!0,email:!0},phone:"required"},messages:{email:"Please enter a valid email address."}}),this.$addVehicleForm.validate({rules:{make:"required",model:"required",color:"required"}}),this.$addLocationForm.validate({rules:{street:"required",city:"required",zip:"required"}})}},{key:"_makeGuestUserSchema",value:function(){return{isGuest:!0,email:this.email(),pwd:Utils.GenerateUUID()}}},{key:"_makeCarSchema",value:function(){return{color:this.color(),make:this.make(),model:this.model(),size:this.selectedCarSize().size,selected:ko.observable(!1)}}},{key:"_makeAppointmentSchema",value:function(e){var t=this.SelectedCars,i=_.find(this.locations(),function(e){return e.selected()})
return{cars:t,date:this.dateMoment.toDate(),location:i,prepaid:e,price:this.discountedTotal(),services:this._buildServicesArray(),timeEstimate:this._getTimeEstimate(),timeRange:this.selectedTimeRange().range,timeRangeKey:this.selectedTimeRange().key,description:this.description()}}},{key:"_makeLocationSchema",value:function(){return{city:this.city(),street:this.street(),title:this.title(),zip:this.zip(),selected:ko.observable(!1)}}},{key:"_getTimeEstimate",value:function(){var e=0
return this.Services().forEach(function(t){t.checked()&&(e+=t.time)}),e+=Configuration.AVG_JOB_SETUP_TIME,e+=Configuration.AVG_JOB_DRIVING_TIME}},{key:"_buildServicesArray",value:function(){var e=[]
return this.Services().forEach(function(t){t.checked()&&e.push(t.title)}),e}},{key:"_buildServicesSummary",value:function(){var e=""
return this.Services().forEach(function(t){t.checked()&&!t.disable()&&(e+=t.title+"<br>")}),e}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i]
n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),WebService=function(){function e(){_classCallCheck(this,e),this.baseUrl=document.location.origin,this.deferred=null}return _createClass(e,[{key:"GetFutureAppointments",value:function(){return this._executeAjaxCall("GET","/api/getFutureApptDatesAndTimes")}},{key:"CreateUser",value:function(e){return this._executeAjaxCall("POST","/api/createNewUser",e)}},{key:"GetUserByEmail",value:function(e){return this._executeAjaxCall("POST","/api/getUserByEmail",{email:e})}},{key:"GetUserByEmailAndPwd",value:function(e,t){return this._executeAjaxCall("POST","/api/getUserByEmailAndPwd",{email:e,pwd:t})}},{key:"SendConfirmationEmail",value:function(e,t,i,n){return this._executeAjaxCall("POST","/api/sendConfirmationEmail",{firstName:e,email:t,phone:i,newAppt:n})}},{key:"UpdateUser",value:function(e){return this._executeAjaxCall("PUT","/api/updateUser",e)}},{key:"ForgotPassword",value:function(e){return this._executeAjaxCall("POST","/api/forgotPassword",{email:e})}},{key:"GetEnvironment",value:function(){return this._executeAjaxCall("GET","/api/getEnvironment")}},{key:"GetSystemSettings",value:function(){return this._executeAjaxCall("GET","/api/getSystemSettings")}},{key:"ExecuteCharge",value:function(e,t,i){return this._executeAjaxCall("POST","/api/executeCharge",{stripeToken:e.id,price:t,lastName:i,email:e.email})}},{key:"VerifyCoupon",value:function(e){return this._executeAjaxCall("POST","/api/verifyCoupon",{code:e})}},{key:"SendGiftEmail",value:function(e,t){return this._executeAjaxCall("POST","/api/createOneTimeCoupon",{email:e,amount:t,duration:90})}},{key:"_executeAjaxCall",value:function(e,t,i){return this.deferred=$.Deferred(),$.ajax({url:this.baseUrl+t,type:e,contentType:"application/json; charset=UTF-8",dataType:"json",error:this._onError.bind(this),success:this._onSuccess.bind(this),timeout:1e4,data:JSON.stringify(i)}),this.deferred.promise()}},{key:"_onSuccess",value:function(e,t,i){if(console.info(e,t,i),this.deferred){var n=e?e.data:null
this.deferred.resolve(n)}}},{key:"_onError",value:function(e,t,i){console.error(e,t,i),this.deferred&&this.deferred.reject(i)}}]),e}()
