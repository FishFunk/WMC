"use strict"
function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),AdminConsoleVm=function(){function e(){_classCallCheck(this,e),this.loginVm=new LoginViewModel(this),this.days=ko.observableArray()}return _createClass(e,[{key:"Load",value:function(){if(this.loginVm.VerifyUser){var e=this
e.days([]),spinner.Show(),webSvc.GetAllAppointments().then(function(n){n=_.sortBy(n,function(e){return e.date})
var t={}
_.each(n,function(e){e.date=moment(e.date).format("MM/DD/YYYY"),t[e.date]?t[e.date].push(e):t[e.date]=[e]})
for(var i in t)t.hasOwnProperty(i)&&e.days.push(new Day(i,t[i]))
console.log(e.days())}).fail(function(e){return console.log(e)}).always(function(){return spinner.Hide()})}}},{key:"DeleteOld",value:function(){if(this.loginVm.VerifyUser){var e=this
bootbox.confirm("Are you sure you want to delete expired appointments?",function(n){n&&(spinner.Show(),webSvc.DeleteExpiredAppointments().then(function(){return e.Load()}).fail(function(e){return console.error(e)}).always(function(){return spinner.Hide()}))})}}},{key:"OnEditAppointment",value:function(e){var n=this,t='<textarea id="edit-appointment-json" style="min-width:500px;min-height:400px;">'+JSON.stringify(e,null,4)+"</textarea>"
return e._id?void bootbox.dialog({title:"Edit Appointment",message:t,buttons:{cancel:{label:"CANCEL",className:"btn-default",callback:function(){}},submit:{label:"DONE",className:"btn-primary",callback:function(){try{var e=$("#edit-appointment-json").val(),t=JSON.parse(e)
webSvc.UpdateAppointment(t).then(function(){bootbox.alert("Update Successful!"),n.Load()}).fail(function(e){console.error(e),bootbox.alert("Update Failed!")})}catch(i){i.Message="Invalid JSON",console.error(i)}}}}}):void bootbox.alert("Unable to update - no ID")}},{key:"OnDeleteAppointment",value:function(e){var n=this
return e?void bootbox.confirm("Are you sure you want to delete this appointment?",function(t){t&&webSvc.DeleteSingleAppointment(e).then(function(){n.Load()}).fail(function(e){console.log(e)})}):void bootbox.alert("No ID found for this appointment. Unable to delete.")}},{key:"LoginViewModel",get:function(){return this.loginVm}}]),e}(),_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),Configuration=function(){function e(n){_classCallCheck(this,e),this.settings=n}return _createClass(e,[{key:"DATE_FORMAT",get:function(){return this.settings.DATE_FORMAT||"MM/DD/YY"}},{key:"DEFAULT_JOB_TIME_MINS",get:function(){return this.settings.DEFAULT_JOB_TIME_MINS||120}},{key:"MAX_JOB_TIME_PER_DAY_MINS",get:function(){return this.settings.MAX_JOB_TIME_PER_DAY_MINS||720}},{key:"MAX_JOB_TIME_PER_INTERVAL",get:function(){return this.settings.MAX_JOB_TIME_PER_INTERVAL||180}},{key:"WASH_DETAILS",get:function(){return this.settings.WASH_DETAILS||{price:19,time:30,title:"Hand wash"}}},{key:"TIRE_SHINE_DETAILS",get:function(){return this.settings.TIRE_SHINE_DETAILS||{price:20,time:30,title:"Tire shine"}}},{key:"INTERIOR_DETAILS",get:function(){return this.settings.INTERIOR_DETAILS||{price:40,time:50,title:"Interior cleaning"}}},{key:"WAX_DETAILS",get:function(){return this.settings.WAX_DETAILS||{price:30,time:50,title:"Hand Wax & Buff"}}},{key:"CAR_SIZES",get:function(){return this.settings.CAR_SIZES||[{multiplier:1,size:"Compact (2-4 door)"},{multiplier:1.2,size:"SUV (5-door)"},{multiplier:1.4,size:"XXL"}]}},{key:"ZIP_WHITE_LIST",get:function(){return this.settings.ZIP_WHITE_LIST||["22314","22301","22305","22302","22304","22202","22206","22311","22312","22204","22041","22211","22201","22203","22209","22044","22151","22150","22152","22153","22015","22205","22042","22046","22003","22207","22213","22031","22043","22027","22101","22182","22030","22032","22039","20124"]}}]),e}(),_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),ASYNC_INTERUPTION_MARKER="ASYNC_INTERUPTION_MARKER",CHARGE_FAILURE_MARKER="CARD_CHARGE_FAILURE",MORNING_TIME_RANGE={range:"9:00 - 12:00 PM",key:1,disabled:ko.observable(!1)},AFTERNOON_TIME_RANGE={range:"12:00 - 3:00 PM",key:2,disabled:ko.observable(!1)},EVENING_TIME_RANGE={range:"3:00 - 6:00 PM",key:3,disabled:ko.observable(!1)},NIGHT_TIME_RANGE={range:"6:00 - 9:00 PM",key:4,disabled:ko.observable(!1)},Constants=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"MORNING_TIME_RANGE",get:function(){return MORNING_TIME_RANGE}},{key:"AFTERNOON_TIME_RANGE",get:function(){return AFTERNOON_TIME_RANGE}},{key:"EVENING_TIME_RANGE",get:function(){return EVENING_TIME_RANGE}},{key:"NIGHT_TIME_RANGE",get:function(){return NIGHT_TIME_RANGE}}]),e}(),Day=function e(n,t){_classCallCheck(this,e),this.day=moment(n).format("dddd"),this.date=n,this.appts=t},spinner=null,webSvc=null,Configuration
window.jQuery(document).ready(function(e){spinner=new LoadingSpinner,webSvc=new WebService,webSvc.GetSystemSettings().then(function(e){Configuration=new Configuration(e)
var n=new AdminConsoleVm
ko.applyBindings(n),n.Load()}).fail(function(e){return console.log(error)})})
var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),LoginViewModel=function(){function e(n){_classCallCheck(this,e),this.consoleVm=n,this.$modal=$("#login-modal"),this.usr=ko.observable(""),this.pwd=ko.observable(""),this.success=!1}return _createClass(e,[{key:"OnVerify",value:function(){var e=this
spinner.Show(),webSvc.VerifyAdmin(this.usr(),this.pwd()).then(function(n){n?(e.success=!0,e.$modal.modal("hide"),e.consoleVm.Load()):bootbox.alert("Invalid Credentials. User and password are case sensitive.")}).fail(function(e){return console.log(e)}).always(function(){return spinner.Hide()})}},{key:"VerifyUser",get:function(){return this.success||this.$modal.modal(),this.success}}]),e}(),_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),LoadingSpinner=function(){function e(){_classCallCheck(this,e)
var n=12,t=12,i=30,r=n+t+i
this.spinner=null,this.options={lines:13,length:t,width:n,radius:i,scale:1,corners:1,color:"#0076A3",opacity:.35,rotate:0,direction:1,speed:.8,trail:45,fps:20,zIndex:2e9,className:"spinner",top:"-"+r.toString(),left:"-"+r.toString(),shadow:!0,hwaccel:!0,position:"relative"},this.spinnerOverlay=$("#page-load-spinner"),this.spinnerContainer=document.getElementById("spinner-container")}return _createClass(e,[{key:"Show",value:function(){$(this.spinnerOverlay).is(":visible")||(this.spinnerOverlay.show(),this.spinner?this.spinner.spin(this.spinnerContainer):this.spinner=new Spinner(this.options).spin(this.spinnerContainer))}},{key:"Hide",value:function(){this.spinnerOverlay.hide(),this.spinner&&this.spinner.stop()}}]),e}(),_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),WebService=function(){function e(){_classCallCheck(this,e),this.baseUrl=document.location.origin,this.deferred=null}return _createClass(e,[{key:"GetAllAppointments",value:function(){return this._executeAjaxCall("GET","/api/getAllAppointments")}},{key:"VerifyAdmin",value:function(e,n){return this._executeAjaxCall("POST","/api/verifyAdmin",{usr:e,pwd:n})}},{key:"DeleteExpiredAppointments",value:function(e){return this._executeAjaxCall("DELETE","/api/deleteExpiredAppointments")}},{key:"DeleteSingleAppointment",value:function(e){return this._executeAjaxCall("DELETE","/api/deleteSingleAppointment?id="+e)}},{key:"UpdateAppointment",value:function(e){return this._executeAjaxCall("POST","/api/updateAppointment",{appt:e})}},{key:"GetSystemSettings",value:function(){return this._executeAjaxCall("GET","/api/getSystemSettings")}},{key:"_executeAjaxCall",value:function(e,n,t){return this.deferred=$.Deferred(),$.ajax({url:this.baseUrl+n,type:e,contentType:"application/json; charset=UTF-8",dataType:"json",error:this._onError.bind(this),success:this._onSuccess.bind(this),timeout:1e4,data:JSON.stringify(t)}),this.deferred.promise()}},{key:"_onSuccess",value:function(e,n,t){if(console.info(e,n,t),this.deferred){var i=e?e.data:null
this.deferred.resolve(i)}}},{key:"_onError",value:function(e,n,t){console.error(e,n,t),this.deferred&&this.deferred.reject(t)}}]),e}()
