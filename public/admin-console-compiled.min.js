"use strict"
function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),AdminConsoleVm=function(){function e(){_classCallCheck(this,e),this.loginVm=new LoginViewModel(this),this.days=ko.observableArray()}return _createClass(e,[{key:"Load",value:function(){if(this.loginVm.VerifyUser){var e=this
e.days([]),spinner.Show(),webSvc.GetAllAppointments().then(function(n){var t={}
_.each(n,function(e){e.date=moment(e.date).format("MM/DD/YYYY"),t[e.date]?t[e.date].push(e):t[e.date]=[e]})
for(var i in t)t.hasOwnProperty(i)&&e.days.push(new Day(i,t[i]))
e.days(_.sortBy(e.days(),function(e){return e.date})),console.log(e.days())}).fail(function(e){return console.log(e)}).always(function(){return spinner.Hide()})}}},{key:"DeleteOld",value:function(){if(this.loginVm.VerifyUser){bootbox.confirm("Are you sure you want to delete expired appointments??",function(e){e&&(spinner.Show(),webSvc.DeleteExpiredAppointments().fail(function(e){return console.log(e)}).always(function(){return spinner.Hide()}))})}}},{key:"LoginViewModel",get:function(){return this.loginVm}}]),e}(),Day=function e(n,t){_classCallCheck(this,e),this.day=moment(n).format("dddd"),this.date=n,this.appts=t},spinner=null,webSvc=null
window.jQuery(document).ready(function(e){spinner=new LoadingSpinner,webSvc=new WebService
var n=new AdminConsoleVm
ko.applyBindings(n),n.Load()})
var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),LoginViewModel=function(){function e(n){_classCallCheck(this,e),this.consoleVm=n,this.$modal=$("#login-modal"),this.usr=ko.observable(""),this.pwd=ko.observable(""),this.success=!1}return _createClass(e,[{key:"OnVerify",value:function(){var e=this
spinner.Show(),webSvc.VerifyAdmin(this.usr(),this.pwd()).then(function(n){n?(e.success=!0,e.$modal.modal("hide"),e.consoleVm.Load()):bootbox.alert("Invalid Credentials. User and password are case sensitive.")}).fail(function(e){return console.log(e)}).always(function(){return spinner.Hide()})}},{key:"VerifyUser",get:function(){return this.success||this.$modal.modal(),this.success}}]),e}(),_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),LoadingSpinner=function(){function e(){_classCallCheck(this,e)
var n=12,t=12,i=30,r=n+t+i
this.spinner=null,this.options={lines:13,length:t,width:n,radius:i,scale:1,corners:1,color:"#0076A3",opacity:.35,rotate:0,direction:1,speed:.8,trail:45,fps:20,zIndex:2e9,className:"spinner",top:"-"+r.toString(),left:"-"+r.toString(),shadow:!0,hwaccel:!0,position:"relative"},this.spinnerOverlay=$("#page-load-spinner"),this.spinnerContainer=document.getElementById("spinner-container")}return _createClass(e,[{key:"Show",value:function(){$(this.spinnerOverlay).is(":visible")||(this.spinnerOverlay.show(),this.spinner?this.spinner.spin(this.spinnerContainer):this.spinner=new Spinner(this.options).spin(this.spinnerContainer))}},{key:"Hide",value:function(){this.spinnerOverlay.hide(),this.spinner&&this.spinner.stop()}}]),e}(),_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t]
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),WebService=function(){function e(){_classCallCheck(this,e),this.baseUrl=document.location.origin,this.deferred=null}return _createClass(e,[{key:"GetAllAppointments",value:function(){return this._executeAjaxCall("GET","/api/getAllAppointments")}},{key:"VerifyAdmin",value:function(e,n){return this._executeAjaxCall("POST","/api/verifyAdmin",{usr:e,pwd:n})}},{key:"DeleteExpiredAppointments",value:function(e){return this._executeAjaxCall("DELETE","/api/deleteExpiredAppointments")}},{key:"_executeAjaxCall",value:function(e,n,t){return this.deferred=$.Deferred(),$.ajax({url:this.baseUrl+n,type:e,contentType:"application/json; charset=UTF-8",dataType:"json",error:this._onError.bind(this),success:this._onSuccess.bind(this),timeout:1e4,data:JSON.stringify(t)}),this.deferred.promise()}},{key:"_onSuccess",value:function(e,n,t){if(console.info(e,n,t),this.deferred){var i=e?e.data:null
this.deferred.resolve(i)}}},{key:"_onError",value:function(e,n,t){console.error(e,n,t),this.deferred&&this.deferred.reject(t)}}]),e}()
